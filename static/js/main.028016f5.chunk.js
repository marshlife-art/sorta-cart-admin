(this["webpackJsonpsorta-cart-admin"]=this["webpackJsonpsorta-cart-admin"]||[]).push([[0],{277:function(e,t,a){e.exports=a(372)},289:function(e){e.exports=JSON.parse('{"name":"sorta-cart-admin","version":"0.0.9","private":true,"homepage":"https://admin.marshcoop.org/","repository":"github:marshlife-art/sorta-cart-admin","scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject","predeploy":"npm run build && cp CNAME build/","deploy":"gh-pages -d build"},"dependencies":{"@bugsnag/js":"^6.5.0","@bugsnag/plugin-react":"^6.5.0","@material-ui/core":"latest","@material-ui/icons":"^4.5.1","@material-ui/lab":"^4.0.0-alpha.36","json2csv":"^4.5.4","material-table":"^1.54.2","react":"latest","react-dom":"latest","react-redux":"^7.1.3","react-router-dom":"^5.1.2","react-scripts":"latest","redux":"^4.0.5","redux-logger":"^3.0.6","redux-thunk":"^2.3.0","typescript":"latest"},"devDependencies":{"@types/react":"latest","@types/react-dom":"latest","@types/react-redux":"^7.1.5","@types/react-router-dom":"^5.1.3","@types/redux-logger":"^3.0.7","@types/jest":"24.0.25","@types/node":"13.1.2","@types/redux-mock-store":"^1.0.1","fake-indexeddb":"^3.0.0","gh-pages":"^2.1.1","jest":"^24.9.0","redux-mock-store":"^1.5.4"},"eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]}}')},372:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(18),l=a.n(c),o=a(236),i=a.n(o),u=a(237),s=a.n(u),d=a(31),m=a(40),p=a(239),f=a(11),g=Object(m.c)({userService:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{isFetching:!1},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET":return Object(f.a)({},e,{user:t.user,error:void 0});case"SET_FETCHING":return Object(f.a)({},e,{isFetching:t.isFetching});case"SET_ERROR":return Object(f.a)({},e,{user:void 0,error:t.error})}return e}}),E=Object(m.c)({preferencesService:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{isFetching:!1},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_PREFERENCES":return Object(f.a)({},e,{preferences:t.preferences,error:void 0});case"SET_FETCHING_PREFERENCES":return Object(f.a)({},e,{isFetching:t.isFetching});case"SET_ERROR_PREFERENCES":return Object(f.a)({},e,{preferences:void 0,error:t.error})}return e}}),h=Object(m.e)(Object(m.c)({session:g,preferences:E}),Object(m.a)(p.a)),b=a(7),v=a(20),y=a(75),O=a(2),j=a(422),S=a(426),w=a(433),k=a(417),C=a(425),I=a(427),_=a(428),x=a(255),N=a.n(x),T=a(378),A=a(411),L=a(205),z=a(256),F=a.n(z),R=a(247),P=a(420),B=a(141),W=a.n(B),M=a(257),D=Object(M.a)({palette:{type:"dark",primary:{main:"#556cd6"},secondary:{main:"#FF4081"},error:{main:W.a.A400}}}),q=Object(M.a)({palette:{type:"light",primary:{main:"#556cd6"},secondary:{main:"#FF4081"},error:{main:W.a.A400}}}),H=a(412),U=a(241),J=a.n(U),$=a(242),G=a.n($),K=a(244),V=a.n(K),Q=a(246),Y=a.n(Q),X=a(146),Z=a.n(X),ee=a(166),te=a.n(ee),ae=a(245),ne=a.n(ae),re=a(243),ce=a.n(re),le=a(111),oe=a.n(le),ie=r.a.createElement("div",null,r.a.createElement(T.a,{button:!0,component:v.b,to:"/"},r.a.createElement(A.a,null,r.a.createElement(J.a,null)),r.a.createElement(L.a,{primary:"Dashboard"})),r.a.createElement(T.a,{button:!0,component:v.b,to:"/products"},r.a.createElement(A.a,null,r.a.createElement(G.a,null)),r.a.createElement(L.a,{primary:"Products"})),r.a.createElement(T.a,{button:!0,component:v.b,to:"/products/import"},r.a.createElement(A.a,null,r.a.createElement(ce.a,null)),r.a.createElement(L.a,{primary:"Import Products"})),r.a.createElement(T.a,{button:!0,component:v.b,to:"/orders"},r.a.createElement(A.a,null,r.a.createElement(V.a,null)),r.a.createElement(L.a,{primary:"Orders"})),r.a.createElement(T.a,{button:!0,component:v.b,to:"/wholesaleorders"},r.a.createElement(A.a,null,r.a.createElement(ne.a,null)),r.a.createElement(L.a,{primary:"Wholesale Orders"})),r.a.createElement(T.a,{button:!0,component:v.b,to:"/users"},r.a.createElement(A.a,null,r.a.createElement(Y.a,null)),r.a.createElement(L.a,{primary:"Users"})),r.a.createElement(T.a,{button:!0,component:v.b,to:"/members"},r.a.createElement(A.a,null,r.a.createElement(Z.a,null)),r.a.createElement(L.a,{primary:"Members"})),r.a.createElement(T.a,{button:!0,component:v.b,to:"/storecredits"},r.a.createElement(A.a,null,r.a.createElement(oe.a,null)),r.a.createElement(L.a,{primary:"Store Credits"}))),ue=(r.a.createElement("div",null,r.a.createElement(H.a,{inset:!0},"Saved reports"),r.a.createElement(T.a,{button:!0},r.a.createElement(A.a,null,r.a.createElement(te.a,null)),r.a.createElement(L.a,{primary:"Current month"})),r.a.createElement(T.a,{button:!0},r.a.createElement(A.a,null,r.a.createElement(te.a,null)),r.a.createElement(L.a,{primary:"Last quarter"})),r.a.createElement(T.a,{button:!0},r.a.createElement(A.a,null,r.a.createElement(te.a,null)),r.a.createElement(L.a,{primary:"Year-end sale"}))),a(24)),se=a.n(ue),de="https://api.marshcoop.org",me=.06391,pe="".concat((100*me).toFixed(3),"%"),fe={new:"new",needs_review:"needs review",pending:"pending",complete:"complete",void:"void",archived:"archived"},ge={balance_due:"balance due",paid:"paid",credit_owed:"credit owed",failed:"failed",void:"void"},Ee={backorder:"backorder",pending:"pending",ready:"ready",shipped:"shipped",partial:"partial",canceled:"canceled"},he="v".concat(Object({NODE_ENV:"production",PUBLIC_URL:""}).npm_package_version||a(289).version," made with \u2665 in NYC"),be=function(e){return{type:"SET",user:e}},ve=function(e){return{type:"SET_ERROR",error:e}},ye=function(e){return{type:"SET_FETCHING",isFetching:e}},Oe={id:void 0,email:void 0,token:void 0},je={dark_mode:"true"},Se=function(e){return{type:"SET_PREFERENCES",preferences:e}},we=function(e){return{type:"SET_FETCHING_PREFERENCES",isFetching:e}},ke=a(413),Ce=a(429);function Ie(){return r.a.createElement(ke.a,{fixed:!0},r.a.createElement(Ce.a,{pt:4,style:{textAlign:"center"}},"L O A D I N G . . ."))}var _e=a(415),xe=a(182),Ne=a(181),Te=a(206),Ae=a(210),Le=a(209),ze=a(207),Fe=a(208),Re=a(83);function Pe(e){return r.a.createElement(Re.a,{component:"h2",variant:"h6",color:"textPrimary",gutterBottom:!0},e.children)}var Be=Object(R.a)((function(e){return{seeMore:{marginTop:e.spacing(3)},rowHover:{"&:hover":{backgroundColor:e.palette.background.default,cursor:"pointer"}}}}));var We=Object(y.h)((function(e){var t=Be(),a=localStorage&&localStorage.getItem("token"),c=Object(n.useState)({data:[],page:0,totalCount:0}),l=Object(b.a)(c,2),o=l[0],i=l[1];return Object(n.useEffect)((function(){a&&i&&fetch("".concat(de,"/orders"),{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({pageSize:10})}).then((function(e){return e.json()})).then(i).catch((function(e){return console.warn(e),{data:[],page:0,totalCount:0}}))}),[a,i]),r.a.createElement(r.a.Fragment,null,r.a.createElement(Pe,null,"recent orders"),r.a.createElement(Te.a,{size:"small"},r.a.createElement(ze.a,null,r.a.createElement(Fe.a,null,r.a.createElement(Le.a,null,"created"),r.a.createElement(Le.a,null,"status"),r.a.createElement(Le.a,null,"name"),r.a.createElement(Le.a,null,"email"),r.a.createElement(Le.a,null,"items"),r.a.createElement(Le.a,null,"subtotal"),r.a.createElement(Le.a,{align:"right"},"total"))),r.a.createElement(Ae.a,null,o.data.map((function(a){return r.a.createElement(Fe.a,{key:a.id,className:t.rowHover,onClick:function(){return e.history.push("/orders/edit/".concat(a.id))}},r.a.createElement(Le.a,null,a.createdAt&&new Date(a.createdAt).toLocaleString()),r.a.createElement(Le.a,null,a.status),r.a.createElement(Le.a,null,a.name),r.a.createElement(Le.a,null,a.email),r.a.createElement(Le.a,null,a.item_count),r.a.createElement(Le.a,null,a.subtotal),r.a.createElement(Le.a,{align:"right"},a.total))})))),r.a.createElement("div",{className:t.seeMore},r.a.createElement(Ne.a,{variant:"contained",color:"primary",onClick:function(t){e.history.push("/orders")}},"SEE MORE ORDERS")))})),Me=Object(R.a)((function(e){return{seeMore:{marginTop:e.spacing(3)},rowHover:{"&:hover":{backgroundColor:e.palette.background.default,cursor:"pointer"}}}}));var De=Object(y.h)((function(e){var t=Me(),a=localStorage&&localStorage.getItem("token"),c=Object(n.useState)({data:[],page:0,totalCount:0}),l=Object(b.a)(c,2),o=l[0],i=l[1];return Object(n.useEffect)((function(){a&&i&&fetch("".concat(de,"/wholesaleorders"),{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({pageSize:10})}).then((function(e){return e.json()})).then(i).catch((function(e){return console.warn(e),{data:[],page:0,totalCount:0}}))}),[a,i]),r.a.createElement(r.a.Fragment,null,r.a.createElement(Pe,null,"recent wholesale orders"),r.a.createElement(Te.a,{size:"small"},r.a.createElement(ze.a,null,r.a.createElement(Fe.a,null,r.a.createElement(Le.a,null,"created"),r.a.createElement(Le.a,null,"vendor"),r.a.createElement(Le.a,null,"status"),r.a.createElement(Le.a,null,"payment status"),r.a.createElement(Le.a,null,"shipment status"))),r.a.createElement(Ae.a,null,o.data.map((function(a){return r.a.createElement(Fe.a,{key:a.id,className:t.rowHover,onClick:function(){return e.history.push("/wholesaleorders/edit/".concat(a.id))}},r.a.createElement(Le.a,null,a.createdAt&&new Date(a.createdAt).toLocaleString()),r.a.createElement(Le.a,null,a.vendor),r.a.createElement(Le.a,null,a.status),r.a.createElement(Le.a,null,a.payment_status),r.a.createElement(Le.a,null,a.shipment_status))})))),r.a.createElement("div",{className:t.seeMore},r.a.createElement(Ne.a,{variant:"contained",color:"primary",onClick:function(t){e.history.push("/wholesaleorders")}},"SEE MORE")))})),qe=Object(R.a)((function(e){return{seeMore:{marginTop:e.spacing(3)},rowHover:{"&:hover":{backgroundColor:e.palette.background.default,cursor:"pointer"}}}}));var He=Object(y.h)((function(e){var t=qe(),a=localStorage&&localStorage.getItem("token"),c=Object(n.useState)({data:[],page:0,totalCount:0}),l=Object(b.a)(c,2),o=l[0],i=l[1];return Object(n.useEffect)((function(){a&&i&&fetch("".concat(de,"/members"),{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({pageSize:10})}).then((function(e){return e.json()})).then(i).catch((function(e){return console.warn(e),{data:[],page:0,totalCount:0}}))}),[a,i]),r.a.createElement(r.a.Fragment,null,r.a.createElement(Pe,null,"recent members"),r.a.createElement(Te.a,{size:"small"},r.a.createElement(ze.a,null,r.a.createElement(Fe.a,null,r.a.createElement(Le.a,null,"created"),r.a.createElement(Le.a,null,"name"),r.a.createElement(Le.a,null,"email"),r.a.createElement(Le.a,{align:"right"},"fees_paid"))),r.a.createElement(Ae.a,null,o.data.map((function(a){return r.a.createElement(Fe.a,{key:a.id,className:t.rowHover,onClick:function(){return e.history.push("/members/".concat(a.id))}},r.a.createElement(Le.a,null,a.createdAt&&new Date(a.createdAt).toLocaleString()),r.a.createElement(Le.a,null,a.name),r.a.createElement(Le.a,null,a.registration_email),r.a.createElement(Le.a,{align:"right"},a.fees_paid))})))),r.a.createElement("div",{className:t.seeMore},r.a.createElement(Ne.a,{variant:"contained",color:"primary",onClick:function(t){e.history.push("/members")}},"SEE ALL MEMBERS")))})),Ue=Object(R.a)((function(e){return{root:{padding:e.spacing(2),minHeight:"100vh"},paper:{padding:e.spacing(2),display:"flex",overflowX:"hidden",flexDirection:"column"}}}));function Je(){var e=Ue();return r.a.createElement("div",{className:e.root},r.a.createElement(_e.a,{container:!0,spacing:3},r.a.createElement(_e.a,{item:!0,xs:12,md:6},r.a.createElement(xe.a,{className:e.paper},r.a.createElement(De,null))),r.a.createElement(_e.a,{item:!0,xs:12,md:6},r.a.createElement(xe.a,{className:e.paper},r.a.createElement(He,null))),r.a.createElement(_e.a,{item:!0,xs:12},r.a.createElement(xe.a,{className:e.paper},r.a.createElement(We,null)))))}var $e=a(211),Ge=Object(R.a)((function(e){return{form:{width:"100%",minHeight:"100vh",marginTop:e.spacing(1),display:"flex",flexDirection:"column",justifyContent:"center"},title:{display:"flex",justifyContent:"space-between",alignItems:"flex-end"},submit:{margin:e.spacing(3,0,2)}}}));var Ke=Object(d.b)((function(e,t){return{userService:e.session.userService}}),(function(e,t){return{login:function(t,a){return e(function(e,t){return function(a){return se.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n){a(ye(!0)),fetch("".concat(de,"/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then((function(e){return e.json()})).then((function(e){"ok"===e.msg&&e.user&&e.user.token?(localStorage&&localStorage.setItem("token",e.user.token),a(be(e.user))):a(ve({error:"error",reason:e.message}))})).catch((function(e){console.log("login error:",e),a(ve({error:"error",reason:"unable to login right now :("}))})).finally((function(){a(ye(!1)),n()}))})));case 1:case"end":return n.stop()}}))}}(t,a))}}}))(Object(y.h)((function(e){var t=e.userService,a=e.history,c=Ge(),l=Object(n.useState)(""),o=Object(b.a)(l,2),i=o[0],u=o[1];return Object(n.useEffect)((function(){t.user&&!t.isFetching&&t.user.role&&"admin"===t.user.role&&a.push("/")}),[t,a]),r.a.createElement(ke.a,{maxWidth:"sm"},r.a.createElement("form",{onSubmit:function(t){t.preventDefault(),u("");var a=t.currentTarget,n=a.elements.namedItem("email"),r=a.elements.namedItem("password");n&&n.value.length>0&&r&&r.value.length>0&&e.login(n.value,r.value)},className:c.form},r.a.createElement("div",{className:c.title},r.a.createElement(Re.a,{variant:"h2",display:"block"},"MARSH COOP"),r.a.createElement(Re.a,{variant:"overline",display:"inline"},"admin")),r.a.createElement($e.a,{label:"email",name:"email",type:"text",autoFocus:!0,fullWidth:!0,required:!0}),r.a.createElement($e.a,{label:"password",name:"password",type:"password",fullWidth:!0,required:!0}),r.a.createElement("div",null,r.a.createElement(Ne.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",disabled:e.userService.isFetching,className:c.submit},"Login")),r.a.createElement(Ce.a,{color:"error.main"},e.userService.error&&r.a.createElement(r.a.Fragment,null,r.a.createElement(Re.a,{variant:"overline",display:"block"},"onoz! an error!"),r.a.createElement(Re.a,{variant:"body1",display:"block",gutterBottom:!0},e.userService.error.reason)),i&&r.a.createElement(r.a.Fragment,null,r.a.createElement(Re.a,{variant:"overline",display:"block"},"onoz! an error!"),r.a.createElement(Re.a,{variant:"body1",display:"block",gutterBottom:!0},i)))))}))),Ve=Object(R.a)((function(e){return{container:{},form:{width:"100%",minHeight:"100vh",marginTop:e.spacing(1),display:"flex",flexDirection:"column",justifyContent:"center"},submit:{margin:e.spacing(3,0,2)}}}));var Qe=Object(d.b)((function(e,t){return{userService:e.session.userService}}),(function(e,t){return{register:function(t,a){return e(function(e,t){return function(a){return se.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n){a(ye(!0)),fetch("".concat(de,"/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({regKey:e,password:t})}).then((function(e){return e.json()})).then((function(e){"ok"===e.msg&&e.user&&e.user.token?(localStorage&&localStorage.setItem("token",e.user.token),a(be(e.user))):a(ve({error:"error",reason:e.message}))})).catch((function(e){console.log("register error:",e),a(ve({error:"error",reason:"unable to register right now :("}))})).finally((function(){a(ye(!1)),n()}))})));case 1:case"end":return n.stop()}}))}}(t,a))}}}))(Object(y.h)((function(e){var t=new URLSearchParams(Object(y.g)().search).get("regKey");console.log("[Register] regKeyParam",t);var a=e.userService,c=e.history,l=Ve(),o=Object(n.useState)(""),i=Object(b.a)(o,2),u=i[0],s=i[1];return Object(n.useEffect)((function(){a.user&&!a.isFetching&&a.user.role&&"admin"===a.user.role&&c.push("/")}),[a,c]),r.a.createElement(ke.a,{maxWidth:"sm",className:l.container},r.a.createElement("form",{onSubmit:function(a){a.preventDefault(),s("");var n=a.currentTarget,r=n.elements.namedItem("password"),c=n.elements.namedItem("password_confirm"),l="";if(t&&(l=t),!l){var o=n.elements.namedItem("regKey");o&&o.value.length>1&&(l=o.value)}l||s("no registration key"),r&&r.value.length>0&&c&&c.value.length>0&&(c.value!==r.value?s("passwords do not match"):e.register(l,c.value))},className:l.form},!t&&r.a.createElement($e.a,{label:"registration key",name:"regKey",type:"text",autoFocus:!0,fullWidth:!0,required:!0}),r.a.createElement($e.a,{label:"password",name:"password",type:"password",autoFocus:!!t,fullWidth:!0,required:!0}),r.a.createElement($e.a,{label:"password_confirm",name:"password_confirm",type:"password",fullWidth:!0,required:!0}),r.a.createElement("div",null,r.a.createElement(Ne.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",disabled:e.userService.isFetching,className:l.submit},"submit")),r.a.createElement(Ce.a,{color:"error.main"},e.userService.error&&r.a.createElement(r.a.Fragment,null,r.a.createElement(Re.a,{variant:"overline",display:"block"},"onoz! an error!"),r.a.createElement(Re.a,{variant:"body1",display:"block",gutterBottom:!0},e.userService.error.reason)),u&&r.a.createElement(r.a.Fragment,null,r.a.createElement(Re.a,{variant:"overline",display:"block"},"onoz! an error!"),r.a.createElement(Re.a,{variant:"body1",display:"block",gutterBottom:!0},u)))))}))),Ye=a(258),Xe=function(e){var t=e.component,a=e.userService,n=e.children,c=Object(Ye.a)(e,["component","userService","children"]);return r.a.createElement(y.b,Object.assign({},c,{render:function(e){return function(e){return!(!e.user||!e.user.role||"admin"!==e.user.role)}(a)?t?r.a.createElement(t,e):n:r.a.createElement(y.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},Ze=a(6),et=a(431),tt=a(418),at=a(419),nt=a(153),rt=a.n(nt),ct=a(212),lt=Object(R.a)((function(e){return{root:{padding:e.spacing(2),margin:e.spacing(2),maxWidth:"100vw",minHeight:"100vh"},header:{fontSize:"1.5em",color:e.palette.text.primary,backgroundColor:e.palette.background.paper},row:{width:"100%",padding:"0 1em",display:"flex",justifyContent:"space-between",alignItems:"center"},nested:{paddingLeft:e.spacing(4)},seeMore:{marginTop:e.spacing(3)},rowHover:{"&:hover":{backgroundColor:e.palette.background.paper}}}})),ot=Object(Ze.a)((function(e){return{root:{backgroundColor:e.palette.background.default,border:"1px solid rgba(0, 0, 0, .125)",boxShadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:"auto"}},expanded:{}}}))(et.a),it=Object(Ze.a)({root:{backgroundColor:"rgba(0, 0, 0, .03)",borderBottom:"1px solid rgba(0, 0, 0, .125)",marginBottom:-1,minHeight:56,"&$expanded":{minHeight:56}},content:{"&$expanded":{margin:"12px 0"}},expanded:{}})(tt.a),ut=Object(Ze.a)((function(e){return{root:{marginLeft:e.spacing(2)}}}))(at.a);var st=Object(y.h)((function(e){var t=lt(),a=localStorage&&localStorage.getItem("token"),c=Object(n.useState)([]),l=Object(b.a)(c,2),o=l[0],i=l[1];return Object(n.useEffect)((function(){fetch("".concat(de,"/admin/store_credit_report"),{method:"get",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)}}).then((function(e){return e.json()})).then((function(e){console.log("store_credit_report result:",e),i(e)})).catch((function(e){console.warn(e),i([])}))}),[a]),console.log("members:",o),r.a.createElement(xe.a,{className:t.root},r.a.createElement(k.a,{component:"nav","aria-labelledby":"nested-list-subheader",subheader:r.a.createElement(H.a,{component:"h1",className:t.header},"Store Credits")},o.map((function(a){return r.a.createElement(r.a.Fragment,{key:a.id},r.a.createElement(T.a,null,r.a.createElement("div",{className:t.row},r.a.createElement(ct.a,{title:"edit member"},r.a.createElement(Ne.a,{onClick:function(){return e.history.push("/members/".concat(a.id))}},a.name)),r.a.createElement(Re.a,null,a.registration_email),r.a.createElement(Re.a,null,"$ ",a.store_credit.toFixed(2)))),r.a.createElement(ot,{square:!0},r.a.createElement(it,{expandIcon:r.a.createElement(rt.a,null),"aria-controls":"panel".concat(a.id,"-content"),id:"panel".concat(a.id,"-header")},r.a.createElement(Re.a,null,"Order Line Items")),r.a.createElement(ut,null,r.a.createElement(Te.a,null,r.a.createElement(ze.a,null,r.a.createElement(Fe.a,null,r.a.createElement(Le.a,null,"createdAt"),r.a.createElement(Le.a,null,"order#"),r.a.createElement(Le.a,null,"description"),r.a.createElement(Le.a,{align:"right"},"total"))),r.a.createElement(Ae.a,null,r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{colSpan:2,align:"center"},"Credits (",a.credits.length,")"),r.a.createElement(Le.a,{align:"right"},"SUM"),r.a.createElement(Le.a,{align:"right"},a.credits_sum)),a.credits.map((function(n){return r.a.createElement(Fe.a,{key:"".concat(a.id).concat(n.id),className:t.rowHover},r.a.createElement(Le.a,null,n.createdAt&&new Date(n.createdAt).toLocaleString()),r.a.createElement(Le.a,null,r.a.createElement(ct.a,{title:"edit order"},r.a.createElement(Ne.a,{onClick:function(){return e.history.push("/orders/edit/".concat(n.OrderId))}},"#",n.OrderId))),r.a.createElement(Le.a,null,n.description),r.a.createElement(Le.a,{align:"right"},n.total))})),r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{colSpan:2,align:"center"},"Adjustments (",a.adjustments.length,")"),r.a.createElement(Le.a,{align:"right"},"SUM"),r.a.createElement(Le.a,{align:"right"},a.adjustments_sum)),a.adjustments.map((function(n){return r.a.createElement(Fe.a,{key:"".concat(a.id).concat(n.id),className:t.rowHover},r.a.createElement(Le.a,null,n.createdAt&&new Date(n.createdAt).toLocaleString()),r.a.createElement(Le.a,null,r.a.createElement(ct.a,{title:"edit order"},r.a.createElement(Ne.a,{onClick:function(){return e.history.push("/orders/edit/".concat(n.OrderId))}},"#",n.OrderId))),r.a.createElement(Le.a,null,n.description),r.a.createElement(Le.a,{align:"right"},n.total))})))))))}))))})),dt=a(71),mt=a.n(dt),pt=a(423),ft=Object(R.a)((function(e){return Object(P.a)({root:{marginRight:e.spacing(2),borderLeft:"".concat(e.spacing(6),"px solid ").concat(e.palette.divider)},gridHeading:{color:e.palette.text.secondary},gridItem:{paddingBottom:e.spacing(2),paddingLeft:e.spacing(2),paddingRight:e.spacing(2),textAlign:"center"},lastUpdated:{marginLeft:e.spacing(2)},squareLink:{marginLeft:"1em"}})}));function gt(e){var t=ft(),a=e.order,n=e.order.OrderLineItems||[],c=n.filter((function(e){return"product"!==e.kind&&"payment"!==e.kind&&"credit"!==e.kind})),l=n.filter((function(e){return"payment"===e.kind})),o=l.reduce((function(e,t){return e+parseFloat("".concat(t.total))}),0),i=n.filter((function(e){return"credit"===e.kind})),u=i.reduce((function(e,t){return e+parseFloat("".concat(t.total))}),0),s=parseFloat("".concat(a.total))+parseFloat("".concat(u))+parseFloat("".concat(o));return r.a.createElement("div",{className:t.root},r.a.createElement(Te.a,{"aria-label":"order details table",size:"small"},r.a.createElement(ze.a,null,r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{component:"th"},"Line Items (",a.item_count,")"),r.a.createElement(Le.a,{component:"th",align:"right"},"price"),r.a.createElement(Le.a,{component:"th",align:"right"},"unit"),r.a.createElement(Le.a,{component:"th",align:"right"},"qty"),r.a.createElement(Le.a,{component:"th",align:"right"},"total"))),r.a.createElement(Ae.a,null,n.map((function(e,t){return"product"===e.kind&&r.a.createElement(Fe.a,{key:"orderli".concat(t)},r.a.createElement(Le.a,{component:"td",scope:"row"},e.vendor&&"[".concat(e.vendor,"] "),e.description,e.data&&e.data.product?" ".concat(e.data.product.unf):""),r.a.createElement(Le.a,{align:"right"},e.price),r.a.createElement(Le.a,{align:"right"},e.selected_unit),r.a.createElement(Le.a,{align:"right"},e.quantity),r.a.createElement(Le.a,{align:"right"},e.total))})),r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{component:"td",scope:"row",colSpan:3}),r.a.createElement(Le.a,{component:"td",scope:"row",align:"right"},r.a.createElement("b",null,"Sub Total")),r.a.createElement(Le.a,{component:"td",scope:"row",align:"right"},a.subtotal)),c.length>0&&r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{component:"td",scope:"row"},r.a.createElement("b",null,"Adjustments"))),c.map((function(e,t){return r.a.createElement(Fe.a,{key:"orderli".concat(t)},r.a.createElement(Le.a,{component:"td",scope:"row",colSpan:3},"(".concat(e.kind,") ")," ",e.description),r.a.createElement(Le.a,{align:"right"},e.quantity),r.a.createElement(Le.a,{align:"right"},e.total))})),r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{component:"td",scope:"row",colSpan:3}),r.a.createElement(Le.a,{component:"td",scope:"row",align:"right"},r.a.createElement("b",null,"Total")),r.a.createElement(Le.a,{component:"td",scope:"row",align:"right"},a.total)),l&&l.length>0&&r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{component:"td",scope:"row"},r.a.createElement("b",null,"Payments"))),l.map((function(e,a){return r.a.createElement(Fe.a,{key:"orderli".concat(a)},r.a.createElement(Le.a,{component:"td",scope:"row",colSpan:3},e.description,e.data&&e.data.payment&&e.data.payment.receipt_number&&r.a.createElement(pt.a,{className:t.squareLink,color:"secondary",href:e.data.payment.receipt_url,target:"_blank",rel:"noopener noreferrer"},e.data.payment.receipt_number)),r.a.createElement(Le.a,{align:"right"},e.quantity),r.a.createElement(Le.a,{align:"right"},e.total))})),i&&i.length>0&&r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{component:"td",scope:"row"},r.a.createElement("b",null,"Credits"))),i.map((function(e,t){return r.a.createElement(Fe.a,{key:"orderli".concat(t)},r.a.createElement(Le.a,{component:"td",scope:"row",colSpan:3},e.description),r.a.createElement(Le.a,{align:"right"},e.quantity),r.a.createElement(Le.a,{align:"right"},e.total))})),s>0&&r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{component:"td",scope:"row",colSpan:3}),r.a.createElement(Le.a,{component:"td",scope:"row",align:"right"},r.a.createElement("b",null,"Balance Due")),r.a.createElement(Le.a,{component:"td",scope:"row",align:"right"},s.toFixed(2))),s<0&&r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{component:"td",scope:"row",colSpan:3}),r.a.createElement(Le.a,{component:"td",scope:"row",align:"right"},r.a.createElement("b",null,"Credit Owed")),r.a.createElement(Le.a,{component:"td",scope:"row",align:"right"},Math.abs(s).toFixed(2))))),r.a.createElement(_e.a,{container:!0,direction:"row",justify:"center",alignItems:"flex-start"},r.a.createElement(_e.a,{item:!0,xs:4},r.a.createElement("div",{className:t.gridItem},r.a.createElement(Re.a,{variant:"overline",display:"block",className:t.gridHeading,gutterBottom:!0},"customer"),r.a.createElement(Re.a,{variant:"body1"},a.name," ",r.a.createElement(pt.a,{color:"secondary",href:"mailto:".concat(a.email)},a.email),r.a.createElement("br",null),r.a.createElement(pt.a,{color:"secondary",href:"tel:".concat(a.phone)},a.phone),r.a.createElement("br",null),a.address," ",r.a.createElement("br",null)))),a.User&&a.User!==a.Member&&r.a.createElement(_e.a,{item:!0,xs:4},r.a.createElement("div",{className:t.gridItem},r.a.createElement(Re.a,{variant:"overline",display:"block",className:t.gridHeading,gutterBottom:!0},"created by"),r.a.createElement(Re.a,{variant:"body1"},r.a.createElement(pt.a,{color:"secondary",href:"mailto:".concat(a.User.email)},a.User.email)," ",a.User.role&&r.a.createElement(r.a.Fragment,null,"(",a.User.role,") ")))),r.a.createElement(_e.a,{item:!0,xs:4},r.a.createElement("div",{className:t.gridItem},r.a.createElement(Re.a,{variant:"overline",display:"block",className:t.gridHeading,gutterBottom:!0},"notes"),r.a.createElement(Re.a,{variant:"body2"},a.notes)))),a.createdAt!==a.updatedAt&&r.a.createElement("div",{className:t.lastUpdated},r.a.createElement("i",null,"Last updated")," ",new Date(a.updatedAt).toLocaleString()))}var Et=Object(R.a)((function(e){return Object(P.a)({root:{padding:e.spacing(2),maxWidth:"100vw",minHeight:"100vh"}})}));var ht=Object(y.h)((function(e){var t=Et(),a=Object(n.createRef)(),c=Object(n.useState)(!1),l=Object(b.a)(c,2),o=l[0],i=l[1],u=Object(n.useState)(!1),s=Object(b.a)(u,2),d=s[0],m=s[1],p=localStorage&&localStorage.getItem("token"),f={icon:o?"zoom_out":"search",tooltip:o?"CLOSE SEARCH":"SEARCH",isFreeAction:!0,onClick:function(){return i(!o)}},g={icon:"add",tooltip:"NEW ORDER",isFreeAction:!0,onClick:function(){return e.history.push("/orders/create")}},E={tooltip:"PRINT",icon:"print",onClick:function(e,t){var a=t.map((function(e){return e.id}));console.log("printAction orderIds:",a," data:",t),fetch("".concat(de,"/orders/print"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(p)},body:JSON.stringify({orderIds:a})}).then((function(e){return e.text()})).then((function(t){try{var a=window.open("about:blank");a&&(a.document.body.innerHTML+=t)}catch(e){console.warn("caught error doing this razzle dazze shit e:",e)}})).catch((function(e){console.warn(e)}))}},h={tooltip:"EDIT",icon:"edit",onClick:function(t,a){a[0]&&a[0].id&&e.history.push("/orders/edit/".concat(a[0].id))}},v=Object(n.useState)([f,g]),y=Object(b.a)(v,2),O=y[0],j=y[1];return Object(n.useEffect)((function(){!d&&j([f,g])}),[o,d]),r.a.createElement("div",{className:t.root},r.a.createElement(mt.a,{tableRef:a,columns:[{title:"#",field:"id",type:"string",filtering:!1},{title:"created",field:"createdAt",type:"datetime",filtering:!1,render:function(e){return new Date(e.createdAt).toLocaleString()}},{title:"status",field:"status",type:"string",lookup:fe},{title:"payment status",field:"payment_status",type:"string",lookup:ge},{title:"shipment status",field:"shipment_status",type:"string",lookup:Ee},{title:"name",field:"name",type:"string",filtering:!1},{title:"email",field:"email",type:"string",filtering:!1},{title:"items",field:"item_count",type:"numeric",filtering:!1},{title:"total",field:"total",type:"currency",filtering:!1},{title:"updated",field:"updatedAt",type:"datetime",filtering:!1,hidden:!0},{title:"phone",field:"phone",type:"string",hidden:!0},{title:"address",field:"address",type:"string",hidden:!0},{title:"notes",field:"notes",type:"string",hidden:!0},{title:"WholesaleOrderId",field:"WholesaleOrderId",type:"string",hidden:!0},{title:"history",field:"history",type:"string",hidden:!0}],data:function(e){return new Promise((function(t,a){fetch("".concat(de,"/orders"),{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(p)},body:JSON.stringify(e)}).then((function(e){return e.json()})).then((function(e){t(e)})).catch((function(e){return console.warn(e),t({data:[],page:0,totalCount:0})}))}))},detailPanel:function(e){return r.a.createElement(gt,{order:e})},onRowClick:function(e,t,a){return a&&a()},title:"Orders",options:{headerStyle:{position:"sticky",top:0},maxBodyHeight:"calc(100vh - 121px - 28px)",pageSize:50,pageSizeOptions:[50,100,500],debounceInterval:750,filtering:!0,search:o,emptyRowsWhenPaging:!1,selection:!0},onSelectionChange:function(e,t){o&&i(!1),0!==e.length?(m(!0),1===e.length?j([E,h]):j([E])):m(!1)},actions:O}))})),bt=a(98),vt=a.n(bt),yt=a(432),Ot=a(152),jt=a(96),St=a.n(jt),wt=a(187),kt=a(215),Ct=a(184),It=a(185),_t={id:"",vendor:"",notes:"",status:"new",payment_status:"balance_due",shipment_status:"backorder",createdAt:"",updatedAt:""},xt=function(e,t,a,r){var c=Object(n.useState)({status:"loading"}),l=Object(b.a)(c,2),o=l[0],i=l[1],u=localStorage&&localStorage.getItem("token");return Object(n.useEffect)((function(){return e?"new"===e?(i({status:"loaded",payload:_t}),t(!1),void r(!1)):void fetch("".concat(de,"/wholesaleorder/").concat(e),{headers:{Authorization:"Bearer ".concat(u)}}).then((function(e){return e.json()})).then((function(e){i({status:"loaded",payload:e})})).catch((function(e){console.warn("useWholesaleOrderService fetch caught err:",e),i(Object(f.a)({},e))})).finally((function(){t(!1),r(!1)})):(t(!1),void r(!1))}),[e,t,a,r,u]),o},Nt=function(e,t,a,r){var c=Object(n.useState)({status:"loading"}),l=Object(b.a)(c,2),o=l[0],i=l[1],u=localStorage&&localStorage.getItem("token");return Object(n.useEffect)((function(){a&&fetch("".concat(de,"/wholesaleorders"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(u)},body:JSON.stringify({status:e})}).then((function(e){return e.json()})).then((function(e){i({status:"loaded",payload:e.data})})).catch((function(e){console.warn("useWholesaleOrderService fetch caught err:",e),i(Object(f.a)({},e))})).finally((function(){r(!1),t(!1)}))}),[a,r,e,t,u]),o},Tt=function(e,t,a,r,c){var l=Object(n.useState)({status:"loading"}),o=Object(b.a)(l,2),i=o[0],u=o[1],s=localStorage&&localStorage.getItem("token");return Object(n.useEffect)((function(){if(t&&e&&e.id){var n="new"===e.id?"/wholesaleorder/create":"/wholesaleorder/upsert";fetch("".concat(de).concat(n),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify(e)}).then((function(e){return e.json()})).then((function(e){u({status:"loaded",payload:e.order}),r(e.msg),c(!0)})).catch((function(e){console.warn("useWholesaleOrderSaveService fetch caught err:",e),u(Object(f.a)({},e)),r("o noz! ".concat(e)),c(!0)})).finally((function(){a(!1)}))}else a(!1)}),[e,t,a,r,c,s]),i},At=a(424),Lt=a(139),zt=a(252),Ft=a.n(zt),Rt=a(160),Pt=a.n(Rt),Bt=a(253),Wt=a.n(Bt),Mt=function(e){return r.a.createElement(Lt.a,Object.assign({elevation:0,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},e))},Dt=Object(Ze.a)((function(e){return{root:{"&:focus":{backgroundColor:e.palette.primary.main,"& .MuiListItemIcon-root, & .MuiListItemText-primary":{color:e.palette.common.white}}}}}))(kt.a);function qt(e){var t=r.a.useState(null),a=Object(b.a)(t,2),n=a[0],c=a[1],l=function(){c(null)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(At.a,{variant:"contained",color:"primary","aria-label":"split button"},r.a.createElement(Ne.a,{variant:"contained",color:"primary",onClick:e.onSaveBtnClick},"save"),r.a.createElement(Ne.a,{"aria-controls":"wholesaleorders-menu","aria-haspopup":"true",variant:"contained",color:"primary",size:"small",onClick:function(e){c(e.currentTarget)}},r.a.createElement(Pt.a,null))),r.a.createElement(Mt,{id:"wholesaleorders-menu",anchorEl:n,keepMounted:!0,open:Boolean(n),onClose:l},r.a.createElement(Dt,{onClick:function(){window.confirm("are you sure?")&&e.onDeleteBtnClick(),l()},disabled:!e.wholesaleOrder.id},r.a.createElement(A.a,null,r.a.createElement(Ft.a,{fontSize:"small"})),r.a.createElement(L.a,{primary:"delete wholesale order"})),r.a.createElement(Dt,{onClick:function(){e.onProductsExportToCsv(),l()},disabled:!e.wholesaleOrder.id},r.a.createElement(A.a,null,r.a.createElement(Wt.a,null)),r.a.createElement(L.a,{primary:"export products to .csv"}))))}var Ht=a(77),Ut=Object(R.a)((function(e){return Object(P.a)({liTable:{marginTop:e.spacing(4)},deleteBtn:{width:"88px"},unf:{minWidth:"105px"},groupedRow:{backgroundColor:e.palette.background.default},groupedRowTotals:e.typography.h6})}));var Jt=Object(y.h)((function(e){var t,a=Ut(),c=localStorage&&localStorage.getItem("token"),l=null===e||void 0===e?void 0:null===(t=e.wholesaleOrder)||void 0===t?void 0:t.OrderLineItems,o=e.lineItemData,i=e.setLineItemData,u=e.setSnackMsg,s=e.setSnackOpen;return Object(n.useEffect)((function(){var e={};i((function(e){return Object(f.a)({},e,{productTotal:0,adjustmentTotal:0,orderTotal:0})})),null===l||void 0===l||l.forEach((function(t){var a=t.data&&t.data.product&&"".concat(t.data.product.unf).concat(t.data.product.upc_code),n=a||t.description,r=e[n],c=t.data&&t.data.product&&"EA"===t.selected_unit?t.quantity/t.data.product.pk:t.quantity,l=t.data&&t.data.product?+(parseFloat(t.data.product.ws_price_cost)*c).toFixed(2):t.total;e[n]={qtySum:r?r.qtySum+c:c,totalSum:r?r.totalSum+l:l,product:t&&t.data&&t.data.product,vendor:t.vendor,description:t.description,line_items:r?[].concat(Object(Ht.a)(r.line_items),[t]):[t]},i((function(e){return Object(f.a)({},e,{productTotal:e.productTotal+parseFloat("".concat(l)),orderTotal:e.orderTotal+l})}))})),Object.values(e).forEach((function(e){if(e.qtySum%1!==0&&e.product){var t=e.product.pk,a=e.line_items.reduce((function(e,t){return e+("EA"===t.selected_unit?t.quantity:0)}),0),n=Math.abs(a%t-t),r=+(n*parseFloat(e.product.u_price_cost)).toFixed(2),c=r;e.line_items.push({quantity:n,price:r,total:c,kind:"adjustment",description:"add ".concat(n," EA")}),e.totalSum=e.totalSum+c,e.qtySum=Math.round(e.qtySum+n/t),i((function(e){return Object(f.a)({},e,{adjustmentTotal:e.adjustmentTotal+ +c,orderTotal:e.orderTotal+c})}))}})),i((function(t){return Object(f.a)({},t,{groupedLineItems:e})}))}),[l]),r.a.createElement(Te.a,{size:"small",className:a.liTable},r.a.createElement(ze.a,null,r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{className:a.deleteBtn}),r.a.createElement(Le.a,{className:a.unf},"unf"),r.a.createElement(Le.a,null,"description"),r.a.createElement(Le.a,null,"price"),r.a.createElement(Le.a,null,"cost"),r.a.createElement(Le.a,null,"pk"),r.a.createElement(Le.a,{align:"center"},"qty"),r.a.createElement(Le.a,{align:"right"},"total"))),r.a.createElement(Ae.a,null,Object.values(o.groupedLineItems).map((function(t,n){return r.a.createElement(r.a.Fragment,{key:"wsgli".concat(n)},r.a.createElement(Fe.a,{className:a.groupedRow},r.a.createElement(Le.a,{className:a.deleteBtn},r.a.createElement(ct.a,{title:"remove line item"},r.a.createElement(Ot.a,{"aria-label":"remove line item",onClick:function(){return function(t){var a=t.line_items.map((function(e){return e.id})).filter((function(e){return e}));a&&a.length&&window.confirm("are you sure?")&&fetch("".concat(de,"/wholesaleorder/removelineitem"),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(c)},body:JSON.stringify({ids:a})}).then((function(e){return e.json()})).then((function(t){return!t.error&&e.setReload(!0)})).catch((function(e){return console.warn("members removelineitem caught err",e)}))}(t)}},r.a.createElement(St.a,null))),r.a.createElement(ct.a,{title:"give order credits"},r.a.createElement(Ot.a,{"aria-label":"issue order credits for this item",onClick:function(){return function(e){var t=e.line_items.map((function(t){return t.OrderId?{OrderId:t.OrderId,total:t.total,description:e.description}:void 0})).filter((function(e){return e}));console.log("issueOrderCredits item:",e," orderIds:",t),window.confirm("will issue order credits. are you sure?")&&fetch("".concat(de,"/wholesaleorder/issuecredits"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(c)},body:JSON.stringify(t)}).then((function(e){return e.json()})).then((function(e){e.error?(u("Unable to create credits!"),s(!0)):(u("Store credits created!"),s(!0))})).catch((function(e){u("onoz! error creating credits: ".concat(e)),s(!0),console.warn("issueOrderCredits caught err",e)}))}(t)}},r.a.createElement(oe.a,null)))),r.a.createElement(Le.a,null,t.product&&"".concat(t.product.unf?t.product.unf:t.product.upc_code," ")),r.a.createElement(Le.a,null,t.product&&"".concat(t.product.name," ").concat(t.product.description),t.product&&r.a.createElement(r.a.Fragment,null,r.a.createElement("br",null),"".concat(t.product.upc_code," ").concat(t.product.category," > ").concat(t.product.sub_category)," ")),r.a.createElement(Le.a,null,t.product&&t.product.ws_price,t.product&&t.product.ws_price!==t.product.u_price?r.a.createElement(r.a.Fragment,null,r.a.createElement("br",null),"(".concat(t.product.u_price,"EA)")):""),r.a.createElement(Le.a,null,t.product&&" ".concat(t.product.ws_price_cost),r.a.createElement("br",null),t.product&&"".concat(t.product.ws_price_cost!==t.product.u_price_cost?"(".concat(t.product.u_price_cost,"EA)"):"")),r.a.createElement(Le.a,null,t.product&&t.product.pk),r.a.createElement(Le.a,{align:"center",className:a.groupedRowTotals},+t.qtySum.toFixed(2)),r.a.createElement(Le.a,{align:"right",className:a.groupedRowTotals},t.totalSum.toFixed(2))),t.line_items.map((function(t){return r.a.createElement(Fe.a,{key:"wsli".concat(t.id)},r.a.createElement(Le.a,{colSpan:2}),r.a.createElement(Le.a,null,"[",t.kind,"] ",t.vendor," ",t.data&&t.data.product&&t.data.product.import_tag?t.data.product.import_tag:t.description," ",t.OrderId&&r.a.createElement(pt.a,{color:"secondary",href:"/orders/edit/".concat(t.OrderId),onClick:function(a){a.preventDefault(),e.history.push("/orders/edit/".concat(t.OrderId))}},"Order #",t.OrderId)),r.a.createElement(Le.a,null),r.a.createElement(Le.a,null),r.a.createElement(Le.a,null,"adjustment"===t.kind?"".concat(t.quantity," EA"):"".concat(t.quantity," ").concat(t.selected_unit)),r.a.createElement(Le.a,{align:"center"},t.data&&t.data.product&&"EA"===t.selected_unit?+(t.quantity/t.data.product.pk).toFixed(2):null),r.a.createElement(Le.a,{align:"right"},t.total))})))})),r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{colSpan:2,align:"center"},"ITEM COUNT"),r.a.createElement(Le.a,{colSpan:2,align:"right"},"PRODUCT TOTAL"),r.a.createElement(Le.a,{colSpan:2,align:"right"},"ADJUSTMENTS TOTAL"),r.a.createElement(Le.a,{colSpan:2,align:"right",className:a.groupedRowTotals},"TOTAL")),r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{colSpan:2,align:"center"},Object.keys(o.groupedLineItems).length),r.a.createElement(Le.a,{colSpan:2,align:"right"},o.productTotal.toFixed(2)),r.a.createElement(Le.a,{colSpan:2,align:"right"},o.adjustmentTotal.toFixed(2)),r.a.createElement(Le.a,{colSpan:2,align:"right",className:a.groupedRowTotals},o.orderTotal.toFixed(2)))))})),$t=a(371).Parser,Gt=Object(R.a)((function(e){return Object(P.a)({vendor:{marginBottom:e.spacing(2),marginRight:e.spacing(2)},editMenu:{padding:"".concat(e.spacing(2),"px 0"),textAlign:"right"}})}));var Kt=Object(y.h)((function(e){var t=Gt(),a=localStorage&&localStorage.getItem("token"),c=Object(n.useState)(""),l=Object(b.a)(c,2),o=l[0],i=l[1],u=Object(n.useState)(),s=Object(b.a)(u,2),d=s[0],m=s[1],p=Object(n.useState)(!0),g=Object(b.a)(p,2),E=g[0],h=g[1],v=Object(n.useState)(!1),y=Object(b.a)(v,2),O=y[0],j=y[1],S=Object(n.useState)(!0),w=Object(b.a)(S,2),k=w[0],C=w[1],I=Object(n.useState)({groupedLineItems:{},productTotal:0,adjustmentTotal:0,orderTotal:0}),_=Object(b.a)(I,2),x=_[0],N=_[1],T=xt(o,h,k,C);Object(n.useEffect)((function(){"loaded"===T.status&&T.payload&&m(T.payload)}),[T,o]);var A=r.a.useState(!1),L=Object(b.a)(A,2),z=L[0],F=L[1],R=r.a.useState(""),P=Object(b.a)(R,2),B=P[0],W=P[1],M=function(e,t){"clickaway"!==t&&F(!1)},D=e.match.params.id;function q(e){return d&&d[e]?d[e]:""}return Object(n.useEffect)((function(){D&&i(D)}),[D]),Tt(d,O,j,W,F),d?r.a.createElement(r.a.Fragment,null,E?r.a.createElement(Ie,null):r.a.createElement(r.a.Fragment,null,r.a.createElement(_e.a,{container:!0,spacing:2,direction:"row",justify:"center",alignItems:"flex-start"},r.a.createElement(_e.a,{item:!0,sm:5},r.a.createElement($e.a,{className:t.vendor,label:"vendor",fullWidth:!0,value:q("vendor"),onChange:function(e){m((function(t){if(t)return Object(f.a)({},t,{vendor:e.target.value})}))}}),r.a.createElement(Ct.a,{fullWidth:!0},r.a.createElement(wt.a,{id:"order-status-select-label"},"status"),r.a.createElement(It.a,{labelId:"order-status-select-label",id:"order-status-select",value:q("status"),onChange:function(e){m((function(t){if(t)return Object(f.a)({},t,{status:e.target.value})}))}},Object.keys(fe).map((function(e){return r.a.createElement(kt.a,{key:"os-sel-".concat(e),value:e},fe[e])})))),r.a.createElement(Ct.a,{fullWidth:!0},r.a.createElement(wt.a,{id:"payment-status-select-label"},"payment status"),r.a.createElement(It.a,{labelId:"payment-status-select-label",id:"payment-status-select",value:q("payment_status"),onChange:function(e){m((function(t){if(t)return Object(f.a)({},t,{payment_status:e.target.value})}))}},Object.keys(ge).map((function(e){return r.a.createElement(kt.a,{key:"ps-sel-".concat(e),value:e},ge[e])})))),r.a.createElement(Ct.a,{fullWidth:!0},r.a.createElement(wt.a,{id:"shipment-status-select-label"},"shipment status"),r.a.createElement(It.a,{labelId:"shipment-status-select-label",id:"shipment-status-select",value:q("shipment_status"),onChange:function(e){m((function(t){if(t)return Object(f.a)({},t,{shipment_status:e.target.value})}))}},Object.keys(Ee).map((function(e){return r.a.createElement(kt.a,{key:"ship-sel-".concat(e),value:e},Ee[e])}))))),r.a.createElement(_e.a,{item:!0,sm:7},r.a.createElement($e.a,{label:"notes",multiline:!0,fullWidth:!0,rows:4,rowsMax:28,value:q("notes"),onChange:function(e){m((function(t){if(t)return Object(f.a)({},t,{notes:e.target.value})}))}}),r.a.createElement("div",{className:t.editMenu},r.a.createElement(qt,{wholesaleOrder:d,onSaveBtnClick:function(){"new"===o&&m((function(e){if(e)return Object(f.a)({},e,{id:"new"})})),j(!0),e.setReloadOrders(!0)},onDeleteBtnClick:function(){d&&fetch("".concat(de,"/wholesaleorder"),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({id:d.id})}).then((function(e){return e.json()})).then((function(t){t.error?(W(t.msg),F(!0)):e.history.replace("/wholesaleorders")})).catch((function(e){console.warn("delete wholesaleOrder fetch caught err:",e),W("o noz! ".concat(e)),F(!0)}))},onProductsExportToCsv:function(){var e=d&&d.vendor;if(e){var t=new $t({fields:["product.unf","product.upc_code","vendor","description","qtySum","totalSum","product.ws_price_cost","product.u_price_cost","product.pk","product.size","product.unit_type","product.category","product.sub_category","product.name","product.description"]}).parse(Object.values(x.groupedLineItems));!function(e,t){if(window.navigator.msSaveBlob){var a=new Blob([t],{type:"text/csv"});window.navigator.msSaveBlob(a,e)}else{var n=document.createElement("a");if(n.download=e,window.URL.createObjectURL){var r=new Blob([t],{type:"text/csv"});n.href=window.URL.createObjectURL(r)}else n.href="data:text/csv;charset=utf-8,"+encodeURIComponent(t);if(document.createEvent){var c=document.createEvent("MouseEvents");c.initEvent("click",!0,!0),n.dispatchEvent(c)}else n.click()}}("".concat(e,".csv"),t)}}})))),r.a.createElement(Jt,{wholesaleOrder:d,setReload:C,lineItemData:x,setLineItemData:N,setSnackMsg:W,setSnackOpen:F})),r.a.createElement(yt.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:z,autoHideDuration:6e3,onClose:M,ContentProps:{"aria-describedby":"message-id"},message:r.a.createElement("span",{id:"message-id"},B),action:[r.a.createElement(Ot.a,{key:"close","aria-label":"close",onClick:M},r.a.createElement(St.a,null))]})):r.a.createElement(Ie,null)})),Vt=Object(R.a)((function(e){return Object(P.a)({root:{maxWidth:"100vw"}})}));var Qt=Object(y.h)((function(e){var t=Vt(),a=localStorage&&localStorage.getItem("token"),c=Object(n.createRef)(),l=Object(n.useState)(!1),o=Object(b.a)(l,2),i=o[0],u=o[1],s=Object(n.useCallback)((function(){c.current&&c.current.onQueryChange(),u(!1)}),[c,u]),d=Object(n.useState)(),m=Object(b.a)(d,2),p=m[0],f=m[1],g={tooltip:"ADD LINE ITEMS TO ORDER",icon:"add",onClick:function(e,t){k(e),Array.isArray(t)&&f(t.map((function(e){return e.id})))}};Object(n.useEffect)((function(){i&&s()}),[i,s]);var E=Object(n.useState)(),h=Object(b.a)(E,2),v=h[0],y=h[1];Object(n.useEffect)((function(){fetch("".concat(de,"/wholesaleorders"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({status:["new","needs_review"]})}).then((function(e){return e.json()})).then((function(e){return y(e.data.map((function(e){return{id:e.id,name:"".concat(e.vendor," ").concat(new Date(e.createdAt).toLocaleDateString())}})))})).catch(console.warn)}),[a]);var O=r.a.useState(null),j=Object(b.a)(O,2),S=j[0],w=j[1],k=function(e){w(e.currentTarget)},I=function(){f([]),w(null)},_=function(t){fetch("".concat(de,"/wholesaleorder/addlineitems"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({id:t,selectedLineItems:p})}).then((function(e){return e.json()})).then((function(e){})).catch(console.warn).finally((function(){I(),u(!0),e.setReloadOrders(!0)}))};return r.a.createElement("div",{className:t.root},r.a.createElement(mt.a,{tableRef:c,columns:[{title:"vendor",field:"vendor",type:"string",filterPlaceholder:"filter"},{title:"OrderId",field:"OrderId",type:"string",filtering:!0,render:function(t){return r.a.createElement(pt.a,{color:"secondary",href:"/orders/edit/".concat(t.OrderId),onClick:function(a){a.preventDefault(),e.history.push("/orders/edit/".concat(t.OrderId))}},"Order #",t.OrderId)}},{title:"qty",field:"quantity",type:"string",filtering:!1},{title:"total",field:"total",type:"string",filtering:!1},{title:"product",field:"data",type:"string",render:function(e){return e.data&&e.data.product?"".concat(e.data.product.name," ").concat(e.data.product.description):null}},{title:"id",field:"id",type:"string",hidden:!0},{title:"WholesaleOrderId",field:"WholesaleOrderId",type:"string",hidden:!0}],data:function(e){return new Promise((function(t,n){fetch("".concat(de,"/wholesaleorders/lineitems"),{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify(e)}).then((function(e){return e.json()})).then((function(e){t(e)})).catch((function(e){return console.warn("onoz, caught err:",e),t({data:[],page:0,totalCount:0})}))}))},title:"Line Items",options:{headerStyle:{position:"sticky",top:0},maxBodyHeight:"calc(100vh - 121px - 28px)",pageSize:50,pageSizeOptions:[50,100,500],debounceInterval:750,filtering:!0,search:!0,emptyRowsWhenPaging:!1,selection:!0},actions:[g]}),r.a.createElement(Lt.a,{id:"simple-menu",anchorEl:S,keepMounted:!0,open:Boolean(S),onClose:I},r.a.createElement(kt.a,{onClick:function(){return _("new")}},"New wholesale order"),r.a.createElement(C.a,null),v&&v.map((function(e){return r.a.createElement(kt.a,{key:"wholesaleorder-sel-".concat(e.id),onClick:function(){return _(e.id)}},e.name)}))))})),Yt=Object(Ze.a)({root:{border:"1px solid rgba(0, 0, 0, .125)",boxShadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:"auto"}},expanded:{}})(et.a),Xt=Object(Ze.a)({root:{backgroundColor:"rgba(0, 0, 0, .03)",borderBottom:"1px solid rgba(0, 0, 0, .125)",marginBottom:-1,minHeight:56,"&$expanded":{minHeight:56}},content:{"&$expanded":{margin:"12px 0"}},expanded:{}})(tt.a),Zt=Object(Ze.a)((function(e){return{root:{padding:0}}}))(at.a),ea=Object(R.a)((function(e){return Object(P.a)({root:{padding:e.spacing(2),maxWidth:"100vw",minHeight:"100vh"},title:{display:"flex",alignItems:"center",justifyContent:"space-between",textAlign:"left",marginLeft:e.spacing(2),padding:e.spacing(2)},titleText:{flexGrow:1},paper:{padding:e.spacing(2),textAlign:"center",color:e.palette.text.secondary,height:"100%"},paperNav:{textAlign:"center",color:e.palette.text.secondary,height:"100%"},list:{padding:0,width:"100%"},selectedListItem:{borderLeft:"".concat(e.spacing(2),"px solid ").concat(e.palette.divider)},noOrdersMsg:{padding:e.spacing(2)}})}));var ta=Object(d.b)((function(e){return{userService:e.session.userService}}),void 0)(Object(y.h)((function(e){var t=ea(),a=e.userService,c=Object(n.useState)([]),l=Object(b.a)(c,2),o=l[0],i=l[1],u=Object(n.useState)(!0),s=Object(b.a)(u,2),d=s[0],m=s[1],p=Object(n.useState)(!1),f=Object(b.a)(p,2),g=f[0],E=f[1],h=Object(n.useState)("new"),O=Object(b.a)(h,2),j=O[0],S=O[1],w=Nt(j,E,d,m);Object(n.useEffect)((function(){"loaded"===w.status&&i(w.payload)}),[w]);var C,I=Object(n.useState)(!1),_=Object(b.a)(I,2),x=_[0],N=_[1],A=function(e,t){"clickaway"!==t&&N(!1)};try{C=window.location.pathname.split("/").reverse()[0],isNaN(parseInt(C))&&(C=void 0)}catch(z){}return a?r.a.createElement(r.a.Fragment,null,r.a.createElement(_e.a,{container:!0,direction:"row",justify:"space-between",alignItems:"stretch",className:t.root,spacing:2},r.a.createElement(_e.a,{sm:12,md:3,lg:2,item:!0},r.a.createElement(xe.a,{className:t.paperNav},r.a.createElement("div",{className:t.title},r.a.createElement(pt.a,{color:"textPrimary",href:"",onClick:function(t){t.preventDefault(),e.history.push("/wholesaleorders")},className:t.titleText},"WHOLESALE ORDERS"),r.a.createElement(Ot.a,{"aria-label":"add wholesale order",title:"add wholeslae order",onClick:function(){return e.history.push("/wholesaleorders/edit/new"),void N(!0)}},r.a.createElement(vt.a,null))),Object.keys(fe).map((function(e){return r.a.createElement(Yt,{square:!0,key:"EP".concat(e),defaultExpanded:"new"===e,expanded:j===e,onChange:function(t,a){return function(e,t){t&&(S(e),m(!0))}(e,a)}},r.a.createElement(Xt,{expandIcon:r.a.createElement(rt.a,null),"aria-controls":"panel".concat(e,"-content"),id:"panel".concat(e,"-header")},r.a.createElement(Re.a,null,fe[e])),r.a.createElement(Zt,null,g?r.a.createElement(Ie,null):r.a.createElement(k.a,{className:t.list},o&&o.length?o.map((function(e,a){return r.a.createElement(T.a,{button:!0,component:v.b,to:"/wholesaleorders/edit/".concat(e.id),key:"wsorder".concat(a),className:C==e.id?t.selectedListItem:void 0},r.a.createElement(L.a,{primary:e.vendor,secondary:new Date(e.createdAt).toLocaleDateString()}))})):r.a.createElement("div",{className:t.noOrdersMsg},r.a.createElement("i",null,"No wholesale orders for this status...")))))})))),r.a.createElement(_e.a,{sm:12,md:9,lg:10,item:!0},r.a.createElement(y.d,null,r.a.createElement(Xe,{userService:a,path:"/wholesaleorders",exact:!0},r.a.createElement(Qt,{setReloadOrders:m})),r.a.createElement(Xe,{userService:a,path:"/wholesaleorders/edit/:id"},r.a.createElement(xe.a,{className:t.paper},r.a.createElement(Kt,{setReloadOrders:m})))))),r.a.createElement(yt.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:x,autoHideDuration:4e3,onClose:A,ContentProps:{"aria-describedby":"message-id"},message:r.a.createElement("span",{id:"message-id"},"Created new Wholesale Order!"),action:[r.a.createElement(Ot.a,{key:"close","aria-label":"close",onClick:A},r.a.createElement(St.a,null))]})):null}))),aa=a(388),na=a(421),ra=a(387),ca=Object(R.a)((function(e){return Object(P.a)({modal:{display:"flex",alignItems:"center",justifyContent:"center"},paper:{backgroundColor:e.palette.background.paper,border:"2px solid #000",boxShadow:e.shadows[5],padding:e.spacing(2,4,3)}})})),la=["admin","member","guest"];function oa(e){var t=localStorage&&localStorage.getItem("token"),a=ca(),c=Object(n.useState)(""),l=Object(b.a)(c,2),o=l[0],i=l[1],u=Object(n.useState)("guest"),s=Object(b.a)(u,2),d=s[0],m=s[1],p=Object(n.useState)(!1),f=Object(b.a)(p,2),g=f[0],E=f[1],h=Object(n.useState)(""),v=Object(b.a)(h,2),y=v[0],O=v[1];Object(n.useEffect)((function(){o&&o.includes("@")?E(!1):E(!0)}),[o]);return r.a.createElement("div",null,r.a.createElement(aa.a,{"aria-labelledby":"transition-modal-title","aria-describedby":"transition-modal-description",className:a.modal,open:e.open,onClose:e.handleClose,closeAfterTransition:!0,BackdropComponent:na.a,BackdropProps:{timeout:500}},r.a.createElement(ra.a,{in:e.open},r.a.createElement("div",{className:a.paper},r.a.createElement("h2",null,"Add New User"),r.a.createElement("div",null,r.a.createElement($e.a,{type:"email",margin:"dense",label:"email",placeholder:"email",value:o,onChange:function(e){return i(e.target.value)},autoFocus:!0,fullWidth:!0}),r.a.createElement(Ct.a,{fullWidth:!0},r.a.createElement(wt.a,{id:"role-select-label"},"Role"),r.a.createElement(It.a,{labelId:"role-select-label",id:"role-select",margin:"dense",value:d,onChange:function(e){return e.target&&e.target.value&&m(e.target.value)}},la.map((function(e){return r.a.createElement(kt.a,{value:e,key:"role-select".concat(e)},e)})))),r.a.createElement(Ne.a,{variant:"contained",color:"primary",onClick:function(){o?(O(""),fetch("".concat(de,"/user/create"),{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({email:o,role:d})}).then((function(e){return e.json()})).then((function(t){if(t.error)return O(t.msg);e.handleRefresh(),e.handleClose()})).catch((function(e){return console.warn(e),O("o noz! there was an error creating user")})).finally((function(){return E(!1)}))):O("type an email!")},disabled:g},"CREATE"),y&&r.a.createElement(Ce.a,{color:"error.main"},r.a.createElement(Re.a,{component:"p"},y)))))))}var ia=Object(Ze.a)({paper:{border:"1px solid #d3d4d5"}})((function(e){return r.a.createElement(Lt.a,Object.assign({elevation:0,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},e))})),ua=Object(Ze.a)((function(e){return{root:{"&:focus":{backgroundColor:e.palette.primary.main,"& .MuiListItemIcon-root, & .MuiListItemText-primary":{color:e.palette.common.white}}}}}))(kt.a);function sa(e){var t=r.a.useState(null),a=Object(b.a)(t,2),n=a[0],c=a[1],l=r.a.useState(e.user.role||"none"),o=Object(b.a)(l,2),i=o[0],u=o[1],s=function(){c(null)},d=function(e,t){if(e){var a=localStorage&&localStorage.getItem("token");fetch("".concat(de,"/user/role"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({id:e,role:t})}).then((function(e){return e.json()})).then((function(e){s(),u(t)})).catch((function(e){return console.warn("handleRoleChange caught err:",e)}))}};return r.a.createElement("div",null,r.a.createElement(Ne.a,{"aria-controls":"user-roles-menu","aria-haspopup":"true",variant:"contained",color:"primary",onClick:function(e){c(e.currentTarget)},disabled:e.disabled},i),r.a.createElement(ia,{id:"user-roles-menu",anchorEl:n,keepMounted:!0,open:Boolean(n),onClose:s},r.a.createElement(ua,null,r.a.createElement(L.a,{primary:"admin",onClick:function(){return d(e.user.id,"admin")}})),r.a.createElement(ua,null,r.a.createElement(L.a,{primary:"member",onClick:function(){return d(e.user.id,"member")}})),r.a.createElement(ua,null,r.a.createElement(L.a,{primary:"guest",onClick:function(){return d(e.user.id,"guest")}}))))}var da=Object(R.a)((function(e){return Object(P.a)({root:{padding:e.spacing(2),maxWidth:"100vw",minHeight:"100vh"}})}));var ma=Object(d.b)((function(e){return{userService:e.session.userService}}),void 0)(Object(y.h)((function(e){var t=da(),a=e.userService,c=Object(n.createRef)();console.log("#TODO: deal with userService:",a);var l=Object(n.useState)(!1),o=Object(b.a)(l,2),i=o[0],u=o[1],s=localStorage&&localStorage.getItem("token"),d=Object(n.useState)(!1),m=Object(b.a)(d,2),p=m[0],f=m[1],g={icon:i?"zoom_out":"search",tooltip:i?"Close Search":"Search",isFreeAction:!0,onClick:function(){return u(!i)}},E={icon:"add",tooltip:"add new user",isFreeAction:!0,onClick:function(){return f(!0)}},h={tooltip:"Remove User",icon:"delete",onClick:function(e,t){if(a&&a.user&&a.user.email===t.email)alert("you cannot delete yrself!");else{if(!t.id)return;window.confirm("Are you sure you want to delete ".concat(t.email,"?"))&&fetch("".concat(de,"/user"),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({id:t.id})}).then((function(e){return e.json()})).then((function(){return c.current&&c.current.onQueryChange()})).catch((function(e){return console.warn("user deleteAction caught err",e)}))}}},v=Object(n.useState)([g,E,h]),y=Object(b.a)(v,2),O=y[0],j=y[1];return Object(n.useEffect)((function(){j([g,E,h])}),[i]),r.a.createElement("div",{className:t.root},r.a.createElement(mt.a,{tableRef:c,columns:[{title:"role",field:"role",type:"string",render:function(e){return r.a.createElement(sa,{user:e,disabled:!(!a||!a.user||a.user.email!==e.email)})}},{title:"email",field:"email",type:"string"},{title:"active",field:"active",type:"boolean",filtering:!1},{title:"created",field:"createdAt",type:"datetime",filtering:!1,render:function(e){return new Date(e.createdAt).toLocaleString()}},{title:"updated",field:"updatedAt",type:"datetime",filtering:!1,render:function(e){return new Date(e.updatedAt).toLocaleString()}},{title:"id",field:"id",type:"string",hidden:!0}],data:function(e){return new Promise((function(t,a){fetch("".concat(de,"/users"),{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify(e)}).then((function(e){return e.json()})).then((function(e){t(e)})).catch((function(e){return console.warn(e),t({data:[],page:0,totalCount:0})}))}))},title:"Users",options:{headerStyle:{position:"sticky",top:0},maxBodyHeight:"calc(100vh - 121px - 28px)",pageSize:50,pageSizeOptions:[50,100,500],debounceInterval:750,filtering:!0,search:i,emptyRowsWhenPaging:!1},actions:O}),r.a.createElement(oa,{open:p,handleClose:function(){f(!1)},handleRefresh:function(){return c.current&&c.current.onQueryChange()}}))}))),pa=a(235),fa={a:"Artificial ingredients",c:"Low carb",d:"Dairy free",f:"Food Service items",g:"Gluten free",k:"Kosher",l:"Low sodium/no salt",m:"Non-GMO Project Verified",og:"Organic",r:"Refined sugar",v:"Vegan",w:"Wheat free",ft:"Fair Trade",n:"Natural",s:"Specialty Only",y:"Yeast free",1:"100% organic",2:"95%+ organic",3:"70%+ organic"};var ga=Object(R.a)((function(e){return Object(P.a)({root:{padding:e.spacing(2),maxWidth:"100vw",minHeight:"100vh"}})}));var Ea=function(){var e=ga(),t=Object(n.createRef)(),a=Object(n.useState)(!1),c=Object(b.a)(a,2),l=c[0],o=c[1],i=Object(n.useCallback)((function(){t.current&&t.current.onQueryChange(),o(!1)}),[t,o]),u=localStorage&&localStorage.getItem("token"),s={tooltip:"destroy all selected products",icon:"delete",onClick:function(e,t){var a=Array.isArray(t)?t.map((function(e){return e.id})):[t.id];0!==a.length&&window.confirm("are sure you want to destroy these ".concat(a.length," products?"))&&fetch("".concat(de,"/products/destroy"),{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(u)},body:JSON.stringify({ids:a})}).catch((function(e){return console.warn("destroy products caught err:",e)})).finally((function(){return o(!0)}))}};Object(n.useEffect)((function(){l&&i()}),[l,i]);var d=Object(n.useState)((function(){fetch("".concat(de,"/categories")).then((function(e){return e.json()})).then((function(e){return f(e)}))})),m=Object(b.a)(d,2),p=m[0],f=m[1],g=Object(n.useState)((function(){fetch("".concat(de,"/sub_categories")).then((function(e){return e.json()})).then((function(e){return v(e)}))})),E=Object(b.a)(g,2),h=E[0],v=E[1],y=Object(n.useState)((function(){fetch("".concat(de,"/products/vendors")).then((function(e){return e.json()})).then((function(e){return S(e)}))})),O=Object(b.a)(y,2),j=O[0],S=O[1];return r.a.createElement("div",{className:e.root},r.a.createElement(mt.a,{tableRef:t,columns:[{title:"category",field:"category",type:"string",lookup:p,filterPlaceholder:"filter"},{title:"sub category",field:"sub_category",type:"string",lookup:h,filterPlaceholder:"filter"},{title:"vendor",field:"vendor",type:"string",lookup:j,filterPlaceholder:"filter"},{title:"name",field:"name",type:"string",hidden:!0},{title:"description",field:"description",type:"string",filterPlaceholder:"filter",filterCellStyle:{paddingTop:"32px"},render:function(e){return e.name?"".concat(e.name," -- ").concat(e.description):e.description}},{title:"pk",field:"pk",type:"numeric",filtering:!1},{title:"size",field:"size",type:"string",filtering:!1},{title:"unit type",field:"unit_type",type:"string",lookup:{CS:"Case",EA:"Each"},filterPlaceholder:"filter"},{title:"price",field:"ws_price",type:"currency",filtering:!1},{title:"unit price",field:"u_price",type:"currency",filtering:!1},{title:"properties",field:"codes",type:"string",lookup:fa,filterPlaceholder:"filter",render:function(e){return(t=e.codes)&&t.split(", ").map((function(e,t){return fa[e]?r.a.createElement(pa.a,{label:fa[e],style:{margin:5},size:"small",key:"pprop".concat(t)}):""}));var t}},{title:"upc",field:"upc_code",type:"string",hidden:!0},{title:"id",field:"id",type:"string",hidden:!0}],data:function(e){return new Promise((function(t,a){fetch("".concat(de,"/products"),{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(e){return e.json()})).then((function(e){t(e)})).catch((function(e){return console.warn("onoz, caught err:",e),t({data:[],page:0,totalCount:0})}))}))},title:"Products",options:{headerStyle:{position:"sticky",top:0},maxBodyHeight:"calc(100vh - 121px - 28px)",pageSize:50,pageSizeOptions:[50,100,500],debounceInterval:750,filtering:!0,search:!0,emptyRowsWhenPaging:!1,selection:!0},actions:[s]}))},ha=a(384),ba=Object(R.a)((function(e){return Object(P.a)({root:{margin:e.spacing(2),padding:e.spacing(2),zIndex:2},gridItem:{margin:e.spacing(2,0)},vendor:{display:"flex",alignItems:"center",margin:e.spacing(2,0)}})}));function va(){var e=ba(),t=Object(n.useState)(!1),a=Object(b.a)(t,2),c=a[0],l=a[1],o=Object(n.useState)(""),i=Object(b.a)(o,2),u=i[0],s=i[1],d=Object(n.useState)(""),m=Object(b.a)(d,2),p=m[0],f=m[1],g=Object(n.useState)(""),E=Object(b.a)(g,2),h=E[0],v=E[1],y=Object(n.useState)(0),O=Object(b.a)(y,2),j=O[0],S=O[1],w=Object(n.useState)(),k=Object(b.a)(w,2),C=k[0],I=k[1],_=Object(n.useState)(""),x=Object(b.a)(_,2),N=x[0],T=x[1],A=Object(n.useState)(""),L=Object(b.a)(A,2),z=L[0],F=L[1],R=Object(n.useState)((function(){fetch("".concat(de,"/products/vendors")).then((function(e){return e.json()})).then((function(e){return W(e)}))})),P=Object(b.a)(R,2),B=P[0],W=P[1],M=Object(n.useState)((function(){fetch("".concat(de,"/products/import_tags")).then((function(e){return e.json()})).then((function(e){return H(e)}))})),D=Object(b.a)(M,2),q=D[0],H=D[1],U=localStorage&&localStorage.getItem("token");var J=r.a.useState(null),$=Object(b.a)(J,2),G=$[0],K=$[1],V=function(){K(null)};return r.a.createElement(xe.a,{className:e.root},r.a.createElement("h3",null,"Import Products"),r.a.createElement(_e.a,{container:!0,spacing:2,direction:"row",justify:"center",alignItems:"flex-start"},r.a.createElement(_e.a,{item:!0,sm:4},r.a.createElement("div",{className:e.vendor},r.a.createElement($e.a,{label:"Vendor",helperText:"Required.",fullWidth:!0,value:u,onChange:function(e){return s(e.target.value)}}),r.a.createElement("div",null,r.a.createElement(Ne.a,{"aria-controls":"customized-menu","aria-haspopup":"true",variant:"contained",color:"primary",size:"small",onClick:function(e){K(e.currentTarget)}},r.a.createElement(Pt.a,null))),r.a.createElement(Lt.a,{id:"vendor-menu",anchorEl:G,keepMounted:!0,open:Boolean(G),onClose:V},B&&Object.keys(B).map((function(e){return r.a.createElement(kt.a,{key:"vendor-sel-".concat(e),onClick:function(){return function(e){s(e),V()}(e)}},e)})))),r.a.createElement(Ct.a,{fullWidth:!0,className:e.gridItem},r.a.createElement(wt.a,{id:"prev-import-tag-select-label"},"Previous Import Tag"),r.a.createElement(It.a,{labelId:"prev-import-tag-select-label",id:"prev-import-tag-select",value:h,onChange:function(e){return e.target&&v(e.target.value)}},r.a.createElement(kt.a,{value:""},"None"),q&&Object.keys(q).map((function(e){return r.a.createElement(kt.a,{key:"tag-sel-".concat(e),value:e},e)}))),r.a.createElement(ha.a,null,"If updating, products with the tag you select here will first be removed.")),r.a.createElement($e.a,{label:"Import Tag",helperText:"Required. This should be unique.",fullWidth:!0,value:p,onChange:function(e){return f(e.target.value)},className:e.gridItem}),r.a.createElement($e.a,{label:"Markup",helperText:"Markup percentage. Use decimal format.",type:"number",inputProps:{min:"0",max:"1",step:"0.01"},fullWidth:!0,value:j,onChange:function(e){return S(isNaN(parseFloat(e.target.value))?0:parseFloat(e.target.value))},className:e.gridItem}),r.a.createElement("input",{type:"file",accept:".csv",onChange:function(e){if(l(!0),e.target.files&&e.target.files.length){var t=new FormData;t.append("file",e.target.files[0]),I(t),l(!1)}else I(void 0),l(!1)},disabled:c,className:e.gridItem}),r.a.createElement("div",{className:e.gridItem},r.a.createElement(Ne.a,{disabled:c||!p||!u||void 0===C,onClick:function(){return T(""),F(""),l(!0),void(C?(C.delete("vendor"),C.delete("import_tag"),C.delete("prev_import_tag"),C.delete("markup"),C.append("vendor",u),C.append("import_tag",p),C.append("prev_import_tag",h),C.append("markup","".concat(j)),fetch("".concat(de,"/products/upload"),{method:"POST",headers:{Authorization:"Bearer ".concat(U)},body:C}).then((function(e){return e.json()})).then((function(e){e.error?T(e.msg):F(e.msg)})).catch((function(e){console.warn("fetch caugher err:",e),T(e.toString())})).finally((function(){return l(!1)}))):T("please select a file!"))},variant:"contained",color:"primary",fullWidth:!0},"IMPORT")),r.a.createElement("div",{className:e.gridItem},c&&r.a.createElement(Ie,null),N&&r.a.createElement("div",{className:e.gridItem},r.a.createElement("h3",null,"Response Error!"),r.a.createElement("p",null,N)),z&&r.a.createElement("div",{className:e.gridItem},r.a.createElement("h3",null,"Response"),r.a.createElement("p",null,z)))),r.a.createElement(_e.a,{item:!0,sm:8},r.a.createElement(Re.a,{variant:"h6",gutterBottom:!0},"Helpful Information"),r.a.createElement(Re.a,{variant:"body1",gutterBottom:!0,component:"div"},r.a.createElement("dl",null,r.a.createElement("dt",null,"What kind of file should be uploaded?"),r.a.createElement("dd",null,"Comma separated value files with the extension .csv"),r.a.createElement("dt",null,"What columns will get processed?"),r.a.createElement("dd",null,r.a.createElement("b",null,"unf"),", ",r.a.createElement("b",null,"upc_code"),", ",r.a.createElement("b",null,"name"),", ",r.a.createElement("b",null,"description"),","," ",r.a.createElement("b",null,"pk"),", ",r.a.createElement("b",null,"size"),", ",r.a.createElement("b",null,"unit_type"),", ",r.a.createElement("b",null,"ws_price"),","," ",r.a.createElement("b",null,"u_price"),", ",r.a.createElement("b",null,"ws_price_markup"),", ",r.a.createElement("b",null,"u_price_markup"),","," ",r.a.createElement("b",null,"category"),", ",r.a.createElement("b",null,"sub_category"),", ",r.a.createElement("b",null,"codes"),", ",r.a.createElement("b",null,"a"),","," ",r.a.createElement("b",null,"r"),", ",r.a.createElement("b",null,"c"),", ",r.a.createElement("b",null,"l"),", ",r.a.createElement("b",null,"d"),", ",r.a.createElement("b",null,"f"),", ",r.a.createElement("b",null,"g"),","," ",r.a.createElement("b",null,"v"),", ",r.a.createElement("b",null,"w"),", ",r.a.createElement("b",null,"y"),", ",r.a.createElement("b",null,"k"),", ",r.a.createElement("b",null,"ft"),", ",r.a.createElement("b",null,"m"),","," ",r.a.createElement("b",null,"s"),", ",r.a.createElement("b",null,"n"),", ",r.a.createElement("b",null,"og"),"."),r.a.createElement("dt",null,"Are any of these optional?"),r.a.createElement("dd",null,r.a.createElement("b",null,"unf"),", ",r.a.createElement("b",null,"ws_price_markup"),", ",r.a.createElement("b",null,"u_price_markup"),","," ",r.a.createElement("b",null,"category"),", ",r.a.createElement("b",null,"sub_category"),", ",r.a.createElement("b",null,"codes"),", ",r.a.createElement("b",null,"a"),","," ",r.a.createElement("b",null,"r"),", ",r.a.createElement("b",null,"c"),", ",r.a.createElement("b",null,"l"),", ",r.a.createElement("b",null,"d"),", ",r.a.createElement("b",null,"f"),", ",r.a.createElement("b",null,"g"),","," ",r.a.createElement("b",null,"v"),", ",r.a.createElement("b",null,"w"),", ",r.a.createElement("b",null,"y"),", ",r.a.createElement("b",null,"k"),", ",r.a.createElement("b",null,"ft"),", ",r.a.createElement("b",null,"m"),","," ",r.a.createElement("b",null,"s"),", ",r.a.createElement("b",null,"n"),", ",r.a.createElement("b",null,"og"),"."),r.a.createElement("dt",null,r.a.createElement("b",null,"codes")," column"),r.a.createElement("dd",null,"the ",r.a.createElement("b",null,"codes")," column value can be a comma-separated list of codes. the values that can be entered in this field are any combination of a, r, c, l, d, f, g, v, w, y, k, ft, m, s, n, og, 1, 2, 3."),r.a.createElement("dt",null,"How do the code columns translate?"),r.a.createElement("dd",null,"The values in the code columns need to be the same as the header. so for example if there's a column ",r.a.createElement("b",null,"a")," then the value for the fields in the column need to be ",r.a.createElement("i",null,"a")," (or blank if not appliciable). except for the ",r.a.createElement("b",null,"og")," column which can have values og, 1, 2, or 3.",r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"code"),r.a.createElement("th",null,"translation"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"a"),r.a.createElement("td",null,"Artificial ingredients")),r.a.createElement("tr",null,r.a.createElement("td",null,"c"),r.a.createElement("td",null,"Low carb")),r.a.createElement("tr",null,r.a.createElement("td",null,"d"),r.a.createElement("td",null,"Dairy free")),r.a.createElement("tr",null,r.a.createElement("td",null,"f"),r.a.createElement("td",null,"Food Service items")),r.a.createElement("tr",null,r.a.createElement("td",null,"g"),r.a.createElement("td",null,"Gluten free")),r.a.createElement("tr",null,r.a.createElement("td",null,"k"),r.a.createElement("td",null,"Kosher")),r.a.createElement("tr",null,r.a.createElement("td",null,"l"),r.a.createElement("td",null,"Low sodium/no salt")),r.a.createElement("tr",null,r.a.createElement("td",null,"m"),r.a.createElement("td",null,"Non-GMO Project Verified")),r.a.createElement("tr",null,r.a.createElement("td",null,"r"),r.a.createElement("td",null,"Refined sugar")),r.a.createElement("tr",null,r.a.createElement("td",null,"v"),r.a.createElement("td",null,"Vegan")),r.a.createElement("tr",null,r.a.createElement("td",null,"w"),r.a.createElement("td",null,"Wheat free")),r.a.createElement("tr",null,r.a.createElement("td",null,"ft"),r.a.createElement("td",null,"Fair Trade")),r.a.createElement("tr",null,r.a.createElement("td",null,"n"),r.a.createElement("td",null,"Natural")),r.a.createElement("tr",null,r.a.createElement("td",null,"s"),r.a.createElement("td",null,"Specialty Only")),r.a.createElement("tr",null,r.a.createElement("td",null,"y"),r.a.createElement("td",null,"Yeast free")),r.a.createElement("tr",null,r.a.createElement("td",null,"og"),r.a.createElement("td",null,"Organic")),r.a.createElement("tr",null,r.a.createElement("td",null,"1"),r.a.createElement("td",null,"100% organic")),r.a.createElement("tr",null,r.a.createElement("td",null,"2"),r.a.createElement("td",null,"95%+ organic")),r.a.createElement("tr",null,r.a.createElement("td",null,"3"),r.a.createElement("td",null,"70%+ organic"))))),r.a.createElement("dt",null,"How is markup applied?"),r.a.createElement("dd",null,"Markup is a percentage in decimal format so 0.10 will markup products by 10%. The formula is: ",r.a.createElement("i",null,"PRICE + (PRICE * MARKUP)")," ","so if the value of ",r.a.createElement("b",null,"ws_price")," is 10.00 and the markup specified is 0.10 the the markup price will be 11.00.",r.a.createElement("br",null),r.a.createElement("br",null),"If any rows of the price sheet has a non-empty, non-zero value in the ",r.a.createElement("b",null,"ws_price_markup")," or ",r.a.createElement("b",null,"u_price_markup")," then that will be used as the markup price. This means only some rows of the price sheet can contain special markups while the rest of the sheet can have a single markup applied."),r.a.createElement("dt",null,"Import Tag"),r.a.createElement("dd",null,"This field is used to track changes to new price sheets that are meant to update products that have already been imported once. A use-case for this is when uploading partial lists of product for a vendor. So for example if a sub-set of products are imported, then a while later a new sheet of products can be imported without having to destroy and re-import all the products for a vendor. If uploading a complete list of all products for a particular vendor then it would be reasonable to use the same value as the Vendor field.",r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("b",null,"NOTE:")," it can be useful to include the current date in the value for the Import Tag field (or otherwise make this a unique value). When creating wholesale orders it might be useful to know which price sheet a product that was ordered came from.",r.a.createElement("br",null),r.a.createElement("br",null),"When the Previous Import Tag is specified, products with that tag are first deleted before new products are created."))))))}var ya=a(66),Oa=a(254),ja=a.n(Oa),Sa=a(99),wa=a.n(Sa),ka=a(161),Ca=a.n(ka),Ia=function(e,t){var a=Object(n.useState)({status:"loading"}),r=Object(b.a)(a,2),c=r[0],l=r[1];return Object(n.useEffect)((function(){if(e&&0!==e.length){var a=localStorage&&localStorage.getItem("token");fetch("".concat(de,"/order/edit/").concat(e),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)}}).then((function(e){return e.json()})).then((function(e){l({status:"loaded",payload:e})})).catch((function(e){console.warn("useOrderService fetch caught err:",e),l(Object(f.a)({},e))})).finally((function(){t(!1)}))}else t(!1)}),[e,t]),c},_a=a(229),xa=Object(R.a)((function(e){return Object(P.a)({root:{width:"100%",overflowX:"auto",height:"100%"},table:{maxWidth:"95vw",padding:e.spacing(1),borderCollapse:"separate","& td":{border:"none"}},qtyinput:{width:"50px"}})}));function Na(e){return void 0===e?"0.00":"$".concat("string"===typeof e?parseFloat(e).toFixed(2):e.toFixed(2))}function Ta(e){var t=e.data&&e.data.product&&e.data.product.u_price?parseFloat(e.data.product.u_price):e.price,a=e.data&&e.data.product?parseFloat(e.data.product.ws_price):e.price;return"EA"===e.selected_unit&&t?isNaN(e.quantity*t)?0:e.quantity*t:isNaN(e.quantity*a)?0:e.quantity*a}var Aa=function(e){var t=xa(),a=e.line_items.filter((function(e){return"product"===e.kind})).map((function(e){var t=e.total;return"string"===typeof t?parseFloat(t):t})).reduce((function(e,t){return e+t}),0),c=function(e){return e.filter((function(e){return"adjustment"===e.kind})).map((function(e){var t=e.total;return parseFloat("".concat(t))})).reduce((function(e,t){return e+t}),0)}(e.line_items),l=me*(a+c),o=l+a+c,i=e.onTaxesChange,u=e.onTotalChange,s=e.onSubTotalChange;Object(n.useEffect)((function(){i(l)}),[l]),Object(n.useEffect)((function(){u(o)}),[o]),Object(n.useEffect)((function(){s(a)}),[a]);var d=function(t,a){t.quantity=a>0?a:1,t.total=Ta(t);var n=e.line_items.indexOf(t);e.onLineItemUpdated(n,t)},m=function(t,a){t.description=a;var n=e.line_items.indexOf(t);e.onLineItemUpdated(n,t)},p=function(t,a){t.price=a,t.total=Ta(t);var n=e.line_items.indexOf(t);e.onLineItemUpdated(n,t)},f=function(t){var a=e.line_items.indexOf(t);e.removeLineItem(a)},g=e.line_items.filter((function(e){return"adjustment"===e.kind})),E=e.line_items.filter((function(e){return"payment"===e.kind})),h=E.reduce((function(e,t){return e+parseFloat("".concat(t.total))}),0),b=e.line_items.filter((function(e){return"credit"===e.kind})),v=b.reduce((function(e,t){return e+parseFloat("".concat(t.total))}),0),y=parseFloat("".concat(o))+parseFloat("".concat(v))+parseFloat("".concat(h));return r.a.createElement(xe.a,{className:t.root},r.a.createElement(Te.a,{className:t.table,"aria-label":"cart"},r.a.createElement(ze.a,null,r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{align:"center"}),r.a.createElement(Le.a,null,"Description"),r.a.createElement(Le.a,{align:"center"},"Price"),r.a.createElement(Le.a,{align:"center"},"Unit"),r.a.createElement(Le.a,{align:"center"},"Qty."),r.a.createElement(Le.a,{align:"center"},"Total"))),r.a.createElement(Ae.a,null,e.line_items.map((function(a,n){return"product"===a.kind&&r.a.createElement(Fe.a,{key:"li".concat(n)},r.a.createElement(Le.a,{align:"center"},r.a.createElement(ct.a,{title:"remove line item"},r.a.createElement(Ot.a,{"aria-label":"delete",size:"small",onClick:function(e){return f(a)}},r.a.createElement(wa.a,{fontSize:"inherit"}))),r.a.createElement(ct.a,{title:"give order credits"},r.a.createElement(Ot.a,{"aria-label":"issue order credits for this item",onClick:function(){return function(t){console.log("createLineItemCredit line_item:",t),e.createCreditFromLineItem(t)}(a)}},r.a.createElement(oe.a,null)))),r.a.createElement(Le.a,null,"[",a.vendor,"] ",a.description),r.a.createElement(Le.a,{align:"right"},r.a.createElement("div",null,a.data&&a.data.product&&"EA"===a.selected_unit&&a.data.product.u_price?Na(a.data.product.u_price):Na(a.data&&a.data.product?a.data.product.ws_price:a.price)),r.a.createElement("div",null,function(e){var t=[];return e.data&&e.data.product&&e.data.product.pk&&1!==e.data.product.pk&&t.push(e.data.product.pk),e.data&&e.data.product&&e.data.product.size&&t.push(e.data.product.size),t.join(" / ")}(a))),r.a.createElement(Le.a,{align:"center"},a.data&&a.data.product&&a.data.product.u_price&&a.data.product.u_price!==a.data.product.ws_price?r.a.createElement(It.a,{value:a.selected_unit,onChange:function(t){return function(t,a){t.selected_unit=a,t.data&&t.data.product&&(t.price="CS"===a?+t.data.product.ws_price:+t.data.product.u_price),t.total=Ta(t);var n=e.line_items.indexOf(t);e.onLineItemUpdated(n,t)}(a,t.target.value)},margin:"dense"},r.a.createElement(kt.a,{value:"CS"},"Case"),r.a.createElement(kt.a,{value:"EA"},"Each")):a.data&&a.data.product&&"CS"===a.data.product.unit_type?"Case":"Each"),r.a.createElement(Le.a,{align:"right"},r.a.createElement($e.a,{className:t.qtyinput,type:"number",InputLabelProps:{shrink:!0},margin:"dense",fullWidth:!0,value:a.quantity,onChange:function(e){return d(a,e.target.value)},inputProps:{min:"1",step:"1"}})),r.a.createElement(Le.a,{align:"right"},Na(a.total)))})),r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{rowSpan:1,colSpan:3}),r.a.createElement(Le.a,{align:"right"},"Subtotal"),r.a.createElement(Le.a,{align:"center"},e.line_items&&e.line_items.length),r.a.createElement(Le.a,{align:"right"},Na(a))),g.map((function(e,a){return r.a.createElement(Fe.a,{key:"li".concat(a)},r.a.createElement(Le.a,{align:"center"},r.a.createElement(ct.a,{title:"remove adjustment"},r.a.createElement(Ot.a,{"aria-label":"delete",size:"small",onClick:function(t){return f(e)}},r.a.createElement(wa.a,{fontSize:"inherit"})))),r.a.createElement(Le.a,{colSpan:2},r.a.createElement($e.a,{type:"text",InputLabelProps:{shrink:!0},margin:"dense",fullWidth:!0,value:e.description,onChange:function(t){return m(e,t.target.value)}})),r.a.createElement(Le.a,null,r.a.createElement($e.a,{type:"number",margin:"dense",fullWidth:!0,value:e.price||e.total,onChange:function(t){return p(e,t.target.value)},inputProps:{min:"-9999",max:"9999",step:"1"},InputProps:{startAdornment:r.a.createElement(_a.a,{position:"start"},"$")}})),r.a.createElement(Le.a,{align:"right"},r.a.createElement($e.a,{className:t.qtyinput,type:"number",InputLabelProps:{shrink:!0},margin:"dense",fullWidth:!0,value:e.quantity,onChange:function(t){return d(e,t.target.value)},inputProps:{min:"1",step:"1"}})),r.a.createElement(Le.a,{align:"right"},Na(e.total)))})),r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{rowSpan:1,colSpan:3}),r.a.createElement(Le.a,{align:"right"},"Tax"),r.a.createElement(Le.a,{align:"center"},pe),r.a.createElement(Le.a,{align:"right"},Na(l))),E.length>0&&r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{component:"td",scope:"row"},r.a.createElement("b",null,"Payments"))),E.map((function(e,a){return r.a.createElement(Fe.a,{key:"li".concat(a)},r.a.createElement(Le.a,{align:"center"},r.a.createElement(ct.a,{title:"remove payment"},r.a.createElement(Ot.a,{"aria-label":"delete",size:"small",onClick:function(t){return f(e)}},r.a.createElement(wa.a,{fontSize:"inherit"})))),r.a.createElement(Le.a,{colSpan:2},r.a.createElement($e.a,{type:"text",InputLabelProps:{shrink:!0},margin:"dense",fullWidth:!0,value:e.description,onChange:function(t){return m(e,t.target.value)}}),e.data&&e.data.payment&&e.data.payment.receipt_number&&r.a.createElement(pt.a,{color:"secondary",href:e.data.payment.receipt_url,target:"_blank",rel:"noopener noreferrer"},e.data.payment.receipt_number)),r.a.createElement(Le.a,null,r.a.createElement($e.a,{type:"number",margin:"dense",fullWidth:!0,value:e.price||e.total,onChange:function(t){return p(e,t.target.value)},inputProps:{min:"-9999",max:"-0.01",step:"0.01"},InputProps:{startAdornment:r.a.createElement(_a.a,{position:"start"},"$")}})),r.a.createElement(Le.a,{align:"right"},r.a.createElement($e.a,{className:t.qtyinput,type:"number",InputLabelProps:{shrink:!0},margin:"dense",fullWidth:!0,value:e.quantity,onChange:function(t){return d(e,t.target.value)},inputProps:{min:"1",step:"1"}})),r.a.createElement(Le.a,{align:"right"},Na(e.total)))})),b.length>0&&r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{component:"td",scope:"row"},r.a.createElement("b",null,"Credits"))),b.map((function(e,a){return r.a.createElement(Fe.a,{key:"li".concat(a)},r.a.createElement(Le.a,{align:"center"},r.a.createElement(ct.a,{title:"remove credit"},r.a.createElement(Ot.a,{"aria-label":"delete",size:"small",onClick:function(t){return f(e)}},r.a.createElement(wa.a,{fontSize:"inherit"})))),r.a.createElement(Le.a,{colSpan:2},r.a.createElement($e.a,{type:"text",InputLabelProps:{shrink:!0},margin:"dense",fullWidth:!0,value:e.description,onChange:function(t){return m(e,t.target.value)}})),r.a.createElement(Le.a,null,r.a.createElement($e.a,{type:"number",margin:"dense",fullWidth:!0,value:e.price||e.total,onChange:function(t){return p(e,t.target.value)},inputProps:{min:"-9999",max:"-0.01",step:"0.01"},InputProps:{startAdornment:r.a.createElement(_a.a,{position:"start"},"$")}})),r.a.createElement(Le.a,{align:"right"},r.a.createElement($e.a,{className:t.qtyinput,type:"number",InputLabelProps:{shrink:!0},margin:"dense",fullWidth:!0,value:e.quantity,onChange:function(t){return d(e,t.target.value)},inputProps:{min:"1",step:"1"}})),r.a.createElement(Le.a,{align:"right"},Na(e.total)))})),r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{rowSpan:1,colSpan:3}),r.a.createElement(Le.a,{align:"right"},"Total"),r.a.createElement(Le.a,{align:"right",colSpan:2},Na(o))),y>0&&r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{component:"td",scope:"row",colSpan:3}),r.a.createElement(Le.a,{component:"td",scope:"row",align:"right"},r.a.createElement("b",null,"Balance Due")),r.a.createElement(Le.a,{component:"td",scope:"row",align:"right",colSpan:2},r.a.createElement("b",null,"$",y.toFixed(2)))),y<0&&r.a.createElement(Fe.a,null,r.a.createElement(Le.a,{component:"td",scope:"row",colSpan:3}),r.a.createElement(Le.a,{component:"td",scope:"row",align:"right"},r.a.createElement("b",null,"Credit Owed")),r.a.createElement(Le.a,{component:"td",scope:"row",align:"right",colSpan:2},r.a.createElement("b",null,"$",Math.abs(y).toFixed(2)))))))},La=a(430),za=a(214);function Fa(e){var t=r.a.useState(!1),a=Object(b.a)(t,2),n=a[0],c=a[1],l=r.a.useState([]),o=Object(b.a)(l,2),i=o[0],u=o[1],s=r.a.useState(""),d=Object(b.a)(s,2),m=d[0],p=d[1],g=r.a.useState(n&&0===i.length),E=Object(b.a)(g,2),h=E[0],v=E[1];return r.a.useEffect((function(){var e=!0;if(h)return function(){var t,a;se.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,se.a.awrap(fetch("".concat(de,"/products"),{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({search:m})}));case 2:return t=n.sent,n.next=5,se.a.awrap(t.json());case 5:a=n.sent,e&&(u(a.data.map((function(e){return{name:"".concat(e.name," ").concat(e.description," ").concat(e.pk," ").concat(e.size," $").concat(e.ws_price," ").concat(e.u_price!==e.ws_price?"($".concat(e.u_price," EA)"):""),product:e}}))),v(!1));case 7:case"end":return n.stop()}}))}(),function(){e=!1}}),[h,m]),r.a.useEffect((function(){n||u([])}),[n]),r.a.createElement(La.a,{id:"add-line-item-autocomplete",style:{width:"100%"},open:n,onOpen:function(){c(!0)},onClose:function(){c(!1)},getOptionSelected:function(e,t){return e.name===t.name},getOptionLabel:function(e){return e.name},onChange:function(t,a){return e.onItemSelected(a)},options:i,loading:h,freeSolo:!0,renderInput:function(e){return r.a.createElement($e.a,Object.assign({},e,{label:"Product search",fullWidth:!0,variant:"outlined",value:m,onChange:function(e){var t;(t=e.target.value)&&t.length>2&&(p(t),v(!0))},InputProps:Object(f.a)({},e.InputProps,{endAdornment:r.a.createElement(r.a.Fragment,null,h?r.a.createElement(za.a,{size:20}):null,e.InputProps.endAdornment)})}))}})}function Ra(e){var t=Object(n.useState)(!1),a=Object(b.a)(t,2),c=a[0],l=a[1],o=Object(n.useState)([]),i=Object(b.a)(o,2),u=i[0],s=i[1],d=Object(n.useState)(""),m=Object(b.a)(d,2),p=m[0],g=m[1],E=Object(n.useState)(c&&0===u.length),h=Object(b.a)(E,2),v=h[0],y=h[1];return Object(n.useEffect)((function(){var e=!0;if(v){var t=localStorage&&localStorage.getItem("token");return function(){var a,n;se.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,se.a.awrap(fetch("".concat(de,"/members"),{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({search:p})}));case 2:return a=r.sent,r.next=5,se.a.awrap(a.json());case 5:n=r.sent,e&&(s(n.data.map((function(e){return{name:"".concat(e.name," ").concat(e.User&&e.User.email?e.User.email:e.registration_email),member:e}}))),y(!1));case 7:case"end":return r.stop()}}))}(),function(){e=!1}}}),[v,p]),Object(n.useEffect)((function(){c||s([])}),[c]),r.a.createElement(La.a,{id:"add-line-item-autocomplete",style:{width:"100%"},open:c,onOpen:function(){l(!0)},onClose:function(){l(!1)},getOptionSelected:function(e,t){return e.name===t.name},getOptionLabel:function(e){return e.name},onChange:function(t,a){return e.onItemSelected(a)},options:u,loading:v,freeSolo:!0,renderInput:function(e){return r.a.createElement($e.a,Object.assign({},e,{label:"Member search",fullWidth:!0,autoFocus:!0,variant:"outlined",value:p,onChange:function(e){var t;(t=e.target.value)&&t.length>0&&(g(t),y(!0))},InputProps:Object(f.a)({},e.InputProps,{endAdornment:r.a.createElement(r.a.Fragment,null,v?r.a.createElement(za.a,{size:20}):null,e.InputProps.endAdornment)})}))}})}var Pa={id:"new",status:"new",payment_status:"balance_due",shipment_status:"backorder",total:0,item_count:0,subtotal:0,name:"",email:"",phone:"",address:"",notes:"",createdAt:"",updatedAt:"",OrderLineItems:[]},Ba=Object(R.a)((function(e){var t;return Object(P.a)({root:{padding:e.spacing(2),maxWidth:"100vw",minHeight:"100vh"},form:{marginBottom:e.spacing(4)},formInput:{display:"block",marginBottom:e.spacing(2)},status:{marginBottom:e.spacing(2)},liHeader:{display:"inline-block",marginRight:e.spacing(2)},sticky:(t={},Object(ya.a)(t,e.breakpoints.up("md"),{position:"sticky",top:"0px"}),Object(ya.a)(t,"zIndex",1),Object(ya.a)(t,"backgroundColor",e.palette.background.paper),t),saveBtn:{flexGrow:1,marginLeft:e.spacing(2)},orderSideHeading:{display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:"54px",marginBottom:e.spacing(2)},emailIcon:{marginRight:"5px"}})}));function Wa(e,t,a){var n;return se.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(t){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,se.a.awrap(fetch("".concat(de,"/admin/store_credit"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({MemberId:e})}).then((function(e){return e.json()})).then((function(e){return e&&e.store_credit?e.store_credit:0})).catch((function(e){return 0})));case 4:n=r.sent,a(n);case 6:case"end":return r.stop()}}))}var Ma=Object(d.b)((function(e){return{userService:e.session.userService}}),void 0)(Object(y.h)((function(e){var t=Ba(),a=localStorage&&localStorage.getItem("token"),c=Object(n.useState)(""),l=Object(b.a)(c,2),o=l[0],i=l[1],u=Object(n.useState)(!0),s=Object(b.a)(u,2),d=s[0],m=s[1],p=Object(n.useState)(Pa),g=Object(b.a)(p,2),E=g[0],h=g[1],v=Object(n.useState)(!1),y=Object(b.a)(v,2),O=y[0],j=y[1],S=Object(n.useState)(!1),w=Object(b.a)(S,2),k=w[0],C=w[1],I=Object(n.useState)(!1),_=Object(b.a)(I,2),x=_[0],N=_[1],T=r.a.useState(!1),A=Object(b.a)(T,2),L=A[0],z=A[1],F=r.a.useState(""),R=Object(b.a)(F,2),P=R[0],B=R[1],W=Object(n.useState)(!0),M=Object(b.a)(W,2),D=M[0],q=M[1],H=Object(n.useState)(!1),U=Object(b.a)(H,2),J=U[0],$=U[1],G=Ia(o,m),K=Object(n.useState)(0),V=Object(b.a)(K,2),Q=V[0],Y=V[1];Object(n.useEffect)((function(){if("loaded"===G.status&&G.payload){var e=G.payload;e.Member&&e.Member.discount&&e.Member.discount>0&&$(!0),e.Member&&e.Member.id&&Wa(e.Member.id,a,Y),h(e)}}),[G,a]);var X=e.match.params.id;Object(n.useEffect)((function(){X&&"new"!==X&&i(X)}),[X]),Object(n.useEffect)((function(){if(E&&!E.UserId&&e.userService&&e.userService.user&&e.userService.user.id){var t=e.userService.user.id;t&&h((function(e){return Object(f.a)({},e,{UserId:t})}))}}),[e.userService,E]),Object(n.useEffect)((function(){if(D&&E){if(E&&E.OrderLineItems&&J){var e=E.OrderLineItems.map((function(e){var t=!1;if(e.data&&e.data.product&&"CS"===e.selected_unit?t=e.data.product.ws_price!==e.data.product.ws_price_cost:e.data&&e.data.product&&"EA"===e.selected_unit&&(t=e.data.product.u_price!==e.data.product.u_price_cost),t&&e.data&&e.data.product){var a="CS"===e.selected_unit?parseFloat(e.data.product.ws_price_cost):parseFloat(e.data.product.u_price_cost);return+(e.total-a*e.quantity).toFixed(2)}return 0})).reduce((function(e,t){return e+t}),0);if(e>0){var t=-e.toFixed(2),a=E.OrderLineItems.filter((function(e){return"adjustment"===e.kind&&"member discount"===e.description}));if(a[0]){if(a[0].total!==t)te(E.OrderLineItems.indexOf(a[0]),Object(f.a)({},a[0],{price:t,total:t}))}else{var n={description:"member discount",quantity:1,price:t,total:t,kind:"adjustment"};h((function(e){return Object(f.a)({},e,{OrderLineItems:[].concat(Object(Ht.a)(e.OrderLineItems),[n])})}))}}}q(!1)}else q(!1)}),[D,E,J]);var ee=function(e,t){"clickaway"!==t&&z(!1)};function te(e,t){h((function(a){var n=a.OrderLineItems;return n.splice(e,1,t),Object(f.a)({},a,{OrderLineItems:n})}))}function ae(e,t){var a=Math.abs(parseFloat("".concat(e))),n=-a,r=-(a+a*me),c={description:t,quantity:1,price:-parseFloat(Math.abs(n).toFixed(2)),total:-parseFloat(Math.abs(r).toFixed(2)),kind:"credit"};h((function(e){return Object(f.a)({},e,{OrderLineItems:[].concat(Object(Ht.a)(e.OrderLineItems),[c])})}))}function ne(e){return E&&E[e]?E[e]:""}var re=!J||E&&0===E.OrderLineItems.filter((function(e){return"member discount"===e.description})).length;return r.a.createElement("div",{className:t.root},d?r.a.createElement(Ie,null):r.a.createElement(_e.a,{container:!0,spacing:2,direction:"row",justify:"center",alignItems:"flex-start"},r.a.createElement(_e.a,{item:!0,xs:12,md:4},r.a.createElement("div",{className:t.sticky},x?r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(ct.a,{title:"close"},r.a.createElement(Ot.a,{"aria-label":"close",onClick:function(){return N(!1)}},r.a.createElement(wa.a,{fontSize:"inherit"}))),r.a.createElement(Ra,{onItemSelected:function(e){if(e&&e.member){var t=e.member,n=t.id,r=t.name,c=t.phone,l=t.address,o=e.member.User&&e.member.User.email?e.member.User.email:e.member.registration_email;h((function(e){return Object(f.a)({},e,{name:r||"",email:o||"",phone:c||"",address:l||"",MemberId:n})})),N(!1),Wa(n,a,Y)}}})):r.a.createElement("div",{className:t.orderSideHeading},r.a.createElement(ct.a,{title:"BACK TO ORDERS"},r.a.createElement(Ot.a,{"aria-label":"back to orders",onClick:function(){return e.history.push("/orders")}},r.a.createElement(Ca.a,null))),r.a.createElement("h2",{style:{display:"inline-block"}},o&&"new"!==o?r.a.createElement(r.a.Fragment,null,"EDIT ORDER ",r.a.createElement("i",null,"#",E.id)):"CREATE ORDER"),r.a.createElement("div",{className:t.saveBtn},r.a.createElement(Ne.a,{variant:"contained",color:"primary",onClick:function(){j(!0);var t=o&&"new"!==o?"/order/update":"/order/create";fetch("".concat(de).concat(t),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify(E)}).then((function(e){return e.json()})).then((function(t){t.success&&(E&&E.Member&&E.Member.id&&Wa(E.Member.id,a,Y),z(!0),B("Saved order!"),!t.order.id||o&&"new"!==o||e.history.replace("/orders/edit/".concat(t.order.id)))})).finally((function(){return j(!1)}))},disabled:O,fullWidth:!0},"Save")),r.a.createElement("div",null,r.a.createElement(ct.a,{title:"ADD USER DETAILS"},r.a.createElement(Ot.a,{"aria-label":"add user details",onClick:function(){return N(!0)}},r.a.createElement(Z.a,null)))))),"new"!==E.status&&"needs_review"!==E.status&&r.a.createElement(Ce.a,{color:"error.main"},r.a.createElement(Re.a,{variant:"overline",display:"block"},"ohey!"),r.a.createElement(Re.a,{variant:"body1",display:"block",gutterBottom:!0},'this order status is not "new" or "needs review" so making changes might not be great...')),E.Member&&E.Member.discount&&r.a.createElement(Ce.a,{color:"info.main"},r.a.createElement(Re.a,{variant:"overline",display:"block",gutterBottom:!0},"Member has discount:"," ",r.a.createElement("b",null,E.Member.discount," ",E.Member.discount_type&&"(".concat(E.Member.discount_type,")")))),0!==Q&&r.a.createElement(Ce.a,{color:"info.main"},r.a.createElement(Re.a,{variant:"overline",display:"block",gutterBottom:!0},"Member has store credit:",r.a.createElement(ct.a,{title:"apply store credit"},r.a.createElement(Ne.a,{"aria-label":"apply store credit",size:"large",onClick:function(){return function(){var e=E&&E.subtotal?E.subtotal:Math.abs(Q),t=Math.abs(Q)>=e?-e:Q,a={description:"STORE CREDIT",quantity:1,price:t,total:t,kind:"adjustment"};h((function(e){return Object(f.a)({},e,{OrderLineItems:[].concat(Object(Ht.a)(e.OrderLineItems),[a])})}))}()}},Q)))),r.a.createElement("form",{className:t.form,noValidate:!0,autoComplete:"off"},r.a.createElement($e.a,{label:"name",type:"text",className:t.formInput,fullWidth:!0,value:E.name,onChange:function(e){e.persist(),h((function(t){return Object(f.a)({},t,{name:e.target.value})}))}}),r.a.createElement($e.a,{label:"email",type:"email",className:t.formInput,fullWidth:!0,value:E.email,onChange:function(e){e.persist(),h((function(t){return Object(f.a)({},t,{email:e.target.value})}))}}),r.a.createElement($e.a,{label:"phone",type:"phone",className:t.formInput,fullWidth:!0,value:E.phone,onChange:function(e){e.persist(),h((function(t){return Object(f.a)({},t,{phone:e.target.value})}))}}),r.a.createElement($e.a,{label:"address",type:"text",className:t.formInput,fullWidth:!0,value:E.address,onChange:function(e){e.persist(),h((function(t){return Object(f.a)({},t,{address:e.target.value})}))}}),r.a.createElement($e.a,{label:"notes",className:t.formInput,multiline:!0,rowsMax:"20",fullWidth:!0,value:E.notes,onChange:function(e){e.persist(),h((function(t){return Object(f.a)({},t,{notes:e.target.value})}))}}),r.a.createElement(Ct.a,{fullWidth:!0,className:t.status},r.a.createElement(wt.a,{id:"order-status-select-label"},"status"),r.a.createElement(It.a,{labelId:"order-status-select-label",id:"order-status-select",value:ne("status"),onChange:function(e){h((function(t){return Object(f.a)({},t,{status:e.target.value})}))}},Object.keys(fe).map((function(e){return r.a.createElement(kt.a,{key:"os-sel-".concat(e),value:e},fe[e])})))),r.a.createElement(Ct.a,{fullWidth:!0,className:t.status},r.a.createElement(wt.a,{id:"payment-status-select-label"},"payment status"),r.a.createElement(It.a,{labelId:"payment-status-select-label",id:"payment-status-select",value:ne("payment_status"),onChange:function(e){h((function(t){return Object(f.a)({},t,{payment_status:e.target.value})}))}},Object.keys(ge).map((function(e){return r.a.createElement(kt.a,{key:"ps-sel-".concat(e),value:e},ge[e])})))),r.a.createElement(Ct.a,{fullWidth:!0,className:t.status},r.a.createElement(wt.a,{id:"shipment-status-select-label"},"shipment status"),r.a.createElement(It.a,{labelId:"shipment-status-select-label",id:"shipment-status-select",value:ne("shipment_status"),onChange:function(e){h((function(t){return Object(f.a)({},t,{shipment_status:e.target.value})}))}},Object.keys(Ee).map((function(e){return r.a.createElement(kt.a,{key:"ship-sel-".concat(e),value:e},Ee[e])})))))),r.a.createElement(_e.a,{item:!0,xs:12,md:8},r.a.createElement("div",null,k?r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(ct.a,{title:"close"},r.a.createElement(Ot.a,{"aria-label":"close",onClick:function(){return C(!1)}},r.a.createElement(wa.a,{fontSize:"inherit"}))),r.a.createElement(Fa,{onItemSelected:function(e){if(e){var t=e.product;if(e&&e.name&&t){var a={description:"".concat(t.name," ").concat(t.description),quantity:1,selected_unit:"CS",price:parseFloat(t.ws_price),total:parseFloat(t.ws_price),kind:"product",vendor:t.vendor,data:{product:t}};h((function(e){return Object(f.a)({},e,{item_count:e.OrderLineItems.filter((function(e){return"product"===e.kind})).length+1,OrderLineItems:[].concat(Object(Ht.a)(e.OrderLineItems),[a])})})),q(!0)}}}})):r.a.createElement(r.a.Fragment,null,r.a.createElement(Ne.a,{"aria-label":"add line items",size:"large",onClick:function(){return C(!0)}},r.a.createElement(vt.a,null),"LINE ITEMS"),r.a.createElement(Ne.a,{"aria-label":"add adjustment",size:"large",onClick:function(e){var t={description:"new adjustment",quantity:1,price:0,total:0,kind:"adjustment"};h((function(e){return Object(f.a)({},e,{OrderLineItems:[].concat(Object(Ht.a)(e.OrderLineItems),[t])})}))}},r.a.createElement(vt.a,null),"ADJUSTMENT"),re&&r.a.createElement(Ne.a,{"aria-label":"add member discount",size:"large",onClick:function(){$(!0),q(!0)}},r.a.createElement(vt.a,null),"MEMBER DISCOUNT"),r.a.createElement(Ne.a,{"aria-label":"add payment",size:"large",onClick:function(e){var t=parseFloat(E.total.toFixed(2))||-0,a={description:"payment",quantity:1,price:-t,total:-t,kind:"payment"};h((function(e){return Object(f.a)({},e,{OrderLineItems:[].concat(Object(Ht.a)(e.OrderLineItems),[a])})}))}},r.a.createElement(vt.a,null),"PAYMENT"),r.a.createElement(Ne.a,{"aria-label":"add credit",size:"large",onClick:function(e){ae(-1,"credit")}},r.a.createElement(vt.a,null),"CREDIT"),r.a.createElement(Ne.a,{"aria-label":"email receipt",size:"large",onClick:function(e){fetch("".concat(de,"/orders/resend_email"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({orderId:E.id})}).then((function(e){return e.json()})).then((function(e){e.success?B("Re-sent email to ".concat(E.email)):B("onoz! could not send email to ".concat(E.email))})).catch((function(e){console.warn("onoz! caught error re-sending email:",e),B("onoz! could not re-send email")})).finally((function(){return z(!0)}))}},r.a.createElement(ja.a,{className:t.emailIcon}),"email receipt"))),r.a.createElement(Aa,{line_items:E.OrderLineItems,onLineItemUpdated:function(e,t){te(e,t),q(!0)},removeLineItem:function(e){if(e>-1){var t=E.OrderLineItems[e];"adjustment"===t.kind&&"member discount"===t.description&&$(!1)}h((function(t){var a=t.OrderLineItems;a.splice(e,1);var n=a.filter((function(e){return"product"===e.kind})).length;return Object(f.a)({},t,{item_count:n,OrderLineItems:a})}))},onTaxesChange:function(e){console.log("onTaxesChange tax:",e),h((function(t){var a=t.OrderLineItems.filter((function(e){return"tax"!==e.kind}));return Object(f.a)({},t,{OrderLineItems:[].concat(Object(Ht.a)(a),[{kind:"tax",description:"tax ".concat(pe),quantity:1,price:e,total:e}])})}))},onTotalChange:function(e){h((function(t){return Object(f.a)({},t,{total:e})}))},onSubTotalChange:function(e){h((function(t){return Object(f.a)({},t,{subtotal:e})}))},createCreditFromLineItem:function(e){ae(e.total,"STORE CREDIT (".concat(e.description,")"))}}))),r.a.createElement(yt.a,{anchorOrigin:{vertical:"bottom",horizontal:"center"},open:L,autoHideDuration:6e3,onClose:ee,ContentProps:{"aria-describedby":"message-id"},message:r.a.createElement("span",{id:"message-id"},P),action:[r.a.createElement(Ot.a,{key:"close","aria-label":"close",onClick:ee},r.a.createElement(St.a,null))]}))}))),Da=Object(R.a)((function(e){return Object(P.a)({root:{padding:e.spacing(2),maxWidth:"100vw",minHeight:"100vh"}})}));var qa=Object(y.h)((function(e){var t=Da(),a=Object(n.createRef)(),c=localStorage&&localStorage.getItem("token"),l={icon:"add",tooltip:"add new member",isFreeAction:!0,onClick:function(){return e.history.push("/members/new")}},o={tooltip:"Remove Member",icon:"delete",onClick:function(e,t){var n;if((n=Array.isArray(t)?t:[t])&&0!==n.length){var r=n[0].id;window.confirm("Are you sure you want to delete this member?")&&fetch("".concat(de,"/member"),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(c)},body:JSON.stringify({id:r})}).then((function(e){return e.json()})).then((function(){return a.current&&a.current.onQueryChange()})).catch((function(e){return console.warn("members deleteAction caught err",e)}))}}},i={icon:"edit",tooltip:"edit member",onClick:function(t,a){var n;(n=Array.isArray(a)?a[0]:a).id&&e.history.push("/members/".concat(n.id))}};return r.a.createElement("div",{className:t.root},r.a.createElement(mt.a,{tableRef:a,columns:[{title:"created",field:"createdAt",type:"datetime",filtering:!1,render:function(e){return e.createdAt&&new Date(e.createdAt).toLocaleString()}},{title:"registration email",field:"registration_email",type:"string",filtering:!1},{title:"name",field:"name",type:"string",filtering:!1},{title:"phone",field:"phone",type:"string",filtering:!1},{title:"address",field:"address",type:"string",filtering:!1},{title:"discount",field:"discount",type:"string"},{title:"discount type",field:"discount_type",type:"string"},{title:"fees paid",field:"fees_paid",type:"string"},{title:"shares",field:"shares",type:"string"},{title:"type",field:"member_type",type:"string"},{title:"updated",field:"updatedAt",type:"datetime",hidden:!0},{title:"id",field:"id",type:"string",hidden:!0}],data:function(e){return new Promise((function(t,a){fetch("".concat(de,"/members"),{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(c)},body:JSON.stringify(e)}).then((function(e){return e.json()})).then((function(e){t(e)})).catch((function(e){return console.warn(e),t({data:[],page:0,totalCount:0})}))}))},title:"Members",options:{headerStyle:{position:"sticky",top:0},maxBodyHeight:"calc(100vh - 121px - 28px)",pageSize:50,pageSizeOptions:[50,100,500],debounceInterval:750,filtering:!0,search:!0,emptyRowsWhenPaging:!1},actions:[l,o,i]}))})),Ha=a(231),Ua=a(234),Ja={id:"new",registration_email:"",name:"",phone:"",address:"",discount:0,discount_type:"",fees_paid:0,store_credit:0,shares:0,member_type:"",data:{}},$a=Object(R.a)((function(e){var t;return Object(P.a)({root:{margin:e.spacing(2),padding:e.spacing(2)},gridItem:{margin:e.spacing(2,0)},sticky:(t={},Object(ya.a)(t,e.breakpoints.up("sm"),{position:"sticky",top:"0"}),Object(ya.a)(t,"zIndex",1),Object(ya.a)(t,"backgroundColor",e.palette.background.paper),Object(ya.a)(t,"width","100%"),t),ordersHeader:{fontSize:"1.25em",backgroundColor:e.palette.background.paper}})}));var Ga=Object(y.h)((function(e){var t=$a(),a=Object(n.useState)(!0),c=Object(b.a)(a,2),l=c[0],o=c[1],i=Object(n.useState)(!1),u=Object(b.a)(i,2),s=u[0],d=u[1],m=Object(n.useState)(""),p=Object(b.a)(m,2),g=p[0],E=p[1],h=Object(n.useState)(""),v=Object(b.a)(h,2),y=v[0],O=v[1],j=e.match.params.id,S=Object(n.useState)(Ja),w=Object(b.a)(S,2),C=w[0],I=w[1],_=Object(n.useState)(!1),x=Object(b.a)(_,2),N=x[0],A=x[1],z=Object(n.useState)(0),F=Object(b.a)(z,2),R=F[0],P=F[1],B=Object(n.useState)([]),W=Object(b.a)(B,2),M=W[0],D=W[1],q=localStorage&&localStorage.getItem("token");return Object(n.useEffect)((function(){j&&"undefined"!==j&&("new"===j?(I(Ja),o(!1)):(fetch("".concat(de,"/members"),{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(q)},body:JSON.stringify({filters:[{column:{field:"id"},value:j}]})}).then((function(e){return e.json()})).then((function(e){I(e.data[0])})).catch((function(e){return I(Ja)})).finally((function(){return o(!1)})),Wa(j,q,P),function(e,t,a){var n;se.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(t){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,se.a.awrap(fetch("".concat(de,"/admin/member_orders"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({MemberId:e})}).then((function(e){return e.json()})).catch((function(e){return[]})));case 4:n=r.sent,a(n);case 6:case"end":return r.stop()}}))}(j,q,D)))}),[j,q]),r.a.createElement(xe.a,{className:t.root},l?r.a.createElement(Ie,null):r.a.createElement(_e.a,{container:!0,spacing:2,direction:"row",justify:"center",alignItems:"flex-start"},r.a.createElement(_e.a,{item:!0,sm:6},r.a.createElement("div",{style:{display:"flex",alignItems:"center",minHeight:"54px"},className:t.sticky},r.a.createElement(ct.a,{title:"BACK TO MEMBERS"},r.a.createElement(Ot.a,{"aria-label":"back to members",onClick:function(){return e.history.push("/members")}},r.a.createElement(Ca.a,null))),r.a.createElement("h2",null,"new"===j?"Create":"Edit"," Member")),r.a.createElement($e.a,{label:"email",fullWidth:!0,value:C.registration_email,className:t.gridItem,onChange:function(e){e.persist(),I((function(t){return Object(f.a)({},t,{registration_email:e.target.value})}))}}),r.a.createElement($e.a,{label:"name",fullWidth:!0,value:C.name,className:t.gridItem,onChange:function(e){e.persist(),I((function(t){return Object(f.a)({},t,{name:e.target.value})}))}}),r.a.createElement($e.a,{label:"phone",fullWidth:!0,value:C.phone,className:t.gridItem,onChange:function(e){e.persist(),I((function(t){return Object(f.a)({},t,{phone:e.target.value})}))}}),r.a.createElement($e.a,{label:"address",fullWidth:!0,value:C.address,className:t.gridItem,onChange:function(e){e.persist(),I((function(t){return Object(f.a)({},t,{address:e.target.value})}))}}),r.a.createElement($e.a,{label:"discount",fullWidth:!0,value:C.discount,type:"number",className:t.gridItem,onChange:function(e){e.persist(),I((function(t){return Object(f.a)({},t,{discount:parseFloat(e.target.value)})}))}}),r.a.createElement($e.a,{label:"discount type",fullWidth:!0,value:C.discount_type,className:t.gridItem,onChange:function(e){e.persist(),I((function(t){return Object(f.a)({},t,{discount_type:e.target.value})}))}}),r.a.createElement($e.a,{label:"fees paid",fullWidth:!0,value:C.fees_paid,type:"number",className:t.gridItem,onChange:function(e){e.persist(),I((function(t){return Object(f.a)({},t,{fees_paid:parseFloat(e.target.value)})}))}}),r.a.createElement($e.a,{label:"store credit",fullWidth:!0,value:C.store_credit,className:t.gridItem,type:"number",helperText:"note: depreciated, don't use this store_credit field anymore."}),r.a.createElement($e.a,{label:"shares",fullWidth:!0,value:C.shares,className:t.gridItem,type:"number",onChange:function(e){e.persist(),I((function(t){return Object(f.a)({},t,{shares:parseFloat(e.target.value)})}))}}),r.a.createElement(Ct.a,{fullWidth:!0,className:t.gridItem},r.a.createElement(wt.a,{id:"prev-import-tag-select-label"},"Type"),r.a.createElement(It.a,{labelId:"prev-import-tag-select-label",id:"prev-import-tag-select",value:C.member_type,onChange:function(e){return e.target&&e.target.value&&I((function(t){return Object(f.a)({},t,{member_type:e.target.value})}))}},r.a.createElement(kt.a,{value:"consumer-owners"},"consumer-owner"),r.a.createElement(kt.a,{value:"worker-owners"},"worker-owner"),r.a.createElement(kt.a,{value:"producer-owners"},"producer owner"))),r.a.createElement(Ct.a,{fullWidth:!0,className:t.gridItem},r.a.createElement(Ha.a,{control:r.a.createElement(Ua.a,{onChange:function(e,t){A(t)},value:"createNewUser"}),label:"Create User"})),r.a.createElement("div",{className:t.gridItem},r.a.createElement(Ne.a,{disabled:s,onClick:function(){return function(){E(""),O(""),d(!0);var e="new"===j?"/create":"/update";fetch("".concat(de,"/member").concat(e),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(q)},body:JSON.stringify({member:C,createNewUser:N})}).then((function(e){return e.json()})).then((function(e){e.error?E(e.msg):O(e.msg)})).catch((function(e){console.warn("fetch caugher err:",e),E(e.toString())})).finally((function(){return d(!1)}))}()},variant:"contained",color:"primary",fullWidth:!0},"new"===j?"CREATE":"SAVE"))),r.a.createElement(_e.a,{item:!0,sm:6,className:t.sticky,zeroMinWidth:!0},s&&r.a.createElement(Ie,null),g&&r.a.createElement("div",{className:t.gridItem},r.a.createElement("h3",null,"Response Error!"),r.a.createElement("p",null,g)),y&&r.a.createElement("div",{className:t.gridItem},r.a.createElement("h3",null,"Response"),r.a.createElement("p",null,y)),C&&C.data&&r.a.createElement("dl",null,Object.keys(C.data).map((function(e){return r.a.createElement(r.a.Fragment,{key:"memberdata".concat(e)},r.a.createElement("dt",null,e),r.a.createElement("dd",null,C.data[e]))}))),0!==R&&r.a.createElement(Ce.a,{color:"info.main"},r.a.createElement(Re.a,{variant:"overline",display:"block",gutterBottom:!0},"Member has store credit: ",R)),M.length>0&&r.a.createElement(k.a,{component:"nav","aria-label":"member orders",subheader:r.a.createElement(H.a,{component:"h2",className:t.ordersHeader},"Orders (",M.length,")")},M.map((function(t){return r.a.createElement(T.a,{key:t.id,button:!0,href:"/orders/edit/".concat(t.id),onClick:function(){return e.history.push("/orders/edit/".concat(t.id))}},r.a.createElement(L.a,{primary:"#".concat(t.id," $").concat(t.total," (").concat(t.item_count,")"),secondary:t.createdAt&&new Date(t.createdAt).toLocaleString()}))}))))))})),Ka=Object(R.a)((function(e){return Object(P.a)({root:{minHeight:"100vh"},nav:{zIndex:e.zIndex.speedDial,display:"flex",alignItems:"center",position:"fixed",top:"-12px",left:"-24px",transition:"200ms ease-in-out","& svg":{display:"none"},"&:hover":{top:-6,left:-12},"&:hover svg":{display:"inline-block"}},drawer:{width:240,flexShrink:0},drawerPaper:{width:240},version:{fontStyle:"italic",fontSize:"0.8em",flexGrow:1,alignSelf:"center",flexDirection:"column",display:"flex",justifyContent:"flex-end"},content:{marginLeft:"16px"}})}));var Va=Object(d.b)((function(e){return{userService:e.session.userService,preferencesService:e.preferences.preferencesService}}),(function(e){return{checkSession:function(){return e((function(e){return se.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e(ye(!0));var a=localStorage&&localStorage.getItem("token");if(!a)return e(ye(!1)),e(be(Oe)),void t();fetch("".concat(de,"/check_session"),{headers:{Authorization:"Bearer ".concat(a)}}).then((function(e){return e.json()})).then((function(t){"ok"===t.msg&&t.user?e(be(t.user)):e(be(Oe))})).catch((function(t){console.warn("check_session caught err:",t),e(be(Oe))})).finally((function(){e(ye(!1)),t()}))})));case 1:case"end":return t.stop()}}))}))},getPreferences:function(){return e((function(e){return se.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,a){e(we(!0));var n=localStorage&&localStorage.getItem("preferences");e(Se(n?JSON.parse(n):je)),e(we(!1)),t()})));case 1:case"end":return t.stop()}}))}))},setPreferences:function(t){return e(function(e){return function(t){return se.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise((function(a,n){t(we(!0)),e?(localStorage&&localStorage.setItem("preferences",JSON.stringify(e)),t(Se(e))):t(Se(je)),t(we(!1)),a()})));case 1:case"end":return a.stop()}}))}}(t))},logout:function(){return e((function(e){return se.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e(ye(!0));var a=localStorage&&localStorage.getItem("token");fetch("".concat(de,"/logout"),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)}}).catch(console.warn).finally((function(){localStorage&&localStorage.removeItem("token"),e(be(Oe)),e(ye(!1)),t()}))})));case 1:case"end":return t.stop()}}))}))}}}))((function(e){var t=Object(n.useState)(!0),a=Object(b.a)(t,2),c=a[0],l=a[1],o=Object(n.useState)(null),i=Object(b.a)(o,2),u=i[0],s=i[1],d=e.checkSession,m=e.userService,p=e.getPreferences,f=e.preferencesService,g=e.setPreferences;Object(n.useEffect)((function(){p&&p()}),[p]),Object(n.useEffect)((function(){f&&!f.isFetching&&f.preferences&&null===u&&s("true"===f.preferences.dark_mode)}),[f]),Object(n.useEffect)((function(){f&&f.preferences&&"true"===f.preferences.dark_mode!==u&&g({dark_mode:u?"true":"false"})}),[u]),Object(n.useEffect)((function(){d&&d()}),[d]),Object(n.useEffect)((function(){m&&!m.isFetching&&m.user&&l(!1)}),[m]);var E=Ka(),h=r.a.useState(!1),x=Object(b.a)(h,2),z=x[0],R=x[1],P=f&&f.preferences&&"true"===f.preferences.dark_mode?D:q;return r.a.createElement(j.a,{theme:P},r.a.createElement(S.a,null),r.a.createElement(v.a,null,r.a.createElement("div",{className:E.root},r.a.createElement(S.a,null),m&&m.user&&"admin"===m.user.role&&r.a.createElement("div",{className:E.nav},r.a.createElement(I.a,{color:"secondary","aria-label":"menu",onClick:function(){return R(!0)}},r.a.createElement(N.a,null))),m&&m.user&&"admin"===m.user.role&&r.a.createElement(w.a,{classes:{paper:Object(O.a)(E.drawerPaper)},onClose:function(){return R(!1)},open:z},r.a.createElement(k.a,{onClick:function(){return R(!1)}},ie),r.a.createElement(C.a,null),r.a.createElement(T.a,{button:!0,onClick:function(){return s((function(e){return!e}))}},r.a.createElement(L.a,null,r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},r.a.createElement("span",null,"Dark Theme"),r.a.createElement(_.a,{checked:null!==u&&void 0!==u&&u,value:"useDarkTheme",inputProps:{"aria-label":"secondary checkbox"}})))),r.a.createElement(C.a,null),r.a.createElement(T.a,{button:!0,onClick:function(){return e.logout()}},r.a.createElement(A.a,null,r.a.createElement(F.a,null)),r.a.createElement(L.a,{primary:"log out",secondary:r.a.createElement("span",{style:{display:"block",textOverflow:"ellipsis",overflow:"hidden"}},m&&m.user?m.user.email:"")})),r.a.createElement("div",{className:E.version},r.a.createElement("span",null,he))),r.a.createElement("main",{className:E.content},c?r.a.createElement(Ie,null):r.a.createElement(y.d,null,r.a.createElement(y.b,{path:"/login",component:Ke}),r.a.createElement(y.b,{path:"/register",component:Qe}),r.a.createElement(Xe,{userService:m,path:"/products",component:Ea,exact:!0}),r.a.createElement(Xe,{userService:m,path:"/products/import",component:va}),r.a.createElement(Xe,{userService:m,path:"/orders",exact:!0,component:ht}),r.a.createElement(Xe,{userService:m,path:"/orders/edit/:id",component:Ma}),r.a.createElement(Xe,{userService:m,path:"/orders/create",component:Ma}),r.a.createElement(Xe,{userService:m,path:"/wholesaleorders",component:ta}),r.a.createElement(Xe,{userService:m,path:"/users",component:ma}),r.a.createElement(Xe,{userService:m,path:"/members",component:qa,exact:!0}),r.a.createElement(Xe,{userService:m,path:"/members/:id",component:Ga}),r.a.createElement(Xe,{userService:m,path:"/storecredits",component:st}),r.a.createElement(Xe,{userService:m,path:"/",component:Je}))))))})),Qa=i()("a9970532605e3f85a84598092888a776");Qa.use(s.a,r.a);var Ya=Qa.getPlugin("react");l.a.render(r.a.createElement(Ya,null,r.a.createElement(d.a,{store:h},r.a.createElement(Va,null))),document.querySelector("#root"))}},[[277,1,2]]]);
//# sourceMappingURL=main.028016f5.chunk.js.map